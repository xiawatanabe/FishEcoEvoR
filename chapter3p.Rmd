---
title: "Chapter 3"
subtitle: Individual Groth and Reproduction
author: 担当 渡邊
date: 2020/6/8
output:
  revealjs::revealjs_presentation:
    theme: white
    self_contained: false
    transition: none 
    highlight: pygments
    #default fade slide convex concave zoom none
    reveal_options:
      #autoSlide: 5000
      width: 960
      height: 720
      control: true
      progress: true
      slideNumber: true
      previewLinks: true
      history: false
      overview: true
      center: false
      left: true
      mouseWheel: false
    fig_width: 6
    fig_height: 4
    fig_caption: false
    #css: "for-revealjs.css"
    #mathjax: local
    #reveal_plugins: ["notes"] #search
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, cache = F, eval = T)
knitr::opts_knit$set(root.dir = normalizePath("C:/RWD/FEEread"))
```


```{r code, include = FALSE}
library(fishsizespectrum)
source("R/basetools.R")

#dir.create("TeX/ChapterIndividual")

getGrowthParameters <- function()
{
  data <- read.csv("Data/fecundpruned.csv",header=TRUE,sep=",")
  data$Winf <- data$aW * data$Linf^data$bW
  data$Wm  <- data$aW * data$Lm^data$bW
  data$Phylum <- data$phyl
  levels(data$Phylum) <- c("Elasmobranchs", "Teleosts")
  #
  # Data from Kooijman and Gislason:
  #
  data2 = read.csv("Data/KooijmanGislason.csv", header=FALSE, col.names=c("K","Linf","T"))
  #
  # Combine data for fish
  # 
  Q10 <- 1.83
  ix  <- data$Phylum == "Teleosts"
  dat <- data.frame(K=data$K[ix] * Q10^((15-data$T[ix])/10), 
                    W=data$Winf[ix])
  dat2 <- data.frame(K=data2$K * Q10^((15-data2$T)/10), W=0.01*data2$Linf^3)
  dat = rbind(dat, dat2)
  
  p <- baseparameters()
  dat$L <- (dat$W/p$c)^(1/3)
  
  dat$A = calcA(dat$K, dat$L)
  
  dat
}

panelvonB <- function()
{
  #
  # Sketch of von B curve
  # 
  Linf <- 100
  K <- 0.18
  
  ages = seq(0,30,length.out=100)
  
  defaultpanel(xlim=ages, ylim=c(0,c(0,110)),
               xlab="Age (years)",
               ylab="Length (cm)",
               label=TRUE)
  lines(ages, Linf*(1-exp(-K*ages)), lwd=3)
  lines(ages, y=K*Linf*ages, lty="dashed", lwd=1)
  lines(x=ages, y=Linf*ages/ages, lty="dashed", lwd=1)
}

panelSketch <- function()
{
  #
  # Sketch of Winf
  # 
  xlim = c(1e-11,1e5)
  ylim = c(5e-10,1e6)
  p <- baseparameters()
  
  n <- p$n
  W1 = 10
  W2 = 10000
  A <- p$A
  k = function(W) A*W^(n-1)
  
  w=10^seq(from=-3, to=6, length.out=100)
  Ea = A

  loglogpanel(xlim=w, ylim=A*w^n, 
              xlab="Body weight (g)", 
              ylab="Available energy, $E_a$ (g/yr)",
              label=TRUE)
  lines(w, A*w^n, lwd=3)
  
  ix = w<10*W1
  lines(w[ix], k(W1)*w[ix])
  lines(W1*c(1,1), c(1e-4,6*W1^n), lty=dashed)

  ix = w<10*W2
  lines(w[ix], k(W2)*w[ix])
  lines(W2*c(1,1), c(1e-4,6*W2^n), lty=dashed)
}


plotSketch_and_vonB <- function()
{
  defaultplot(mfcol=c(1,2))
  panelvonB()
  panelSketch()
}


plotKvsLinf <- function()
{
  dat <- getGrowthParameters()
  
  fig <- ggplot() +
    geom_point(data=dat, aes(x=L, y=K), colour=grey(0.3))
  # fit
  fit <- lm(log(K) ~ log(L), data=dat)
  tmp <- data.frame(x=dat$L, y=exp(predict(fit)))
  cat('Fit of K: C = ', exp(fit$coefficients[1]), 
      ' and exponent ', fit$coefficients[2], "\n")
  
  # fit with exponent -0.75:
  C <- exp(mean(log(dat$K * dat$L^0.75)))
  cat('K fitted wit n=0.75: ', C, "\n")
  
  # fit with exponent -1:
  C2 <- exp(mean(log(dat$K * dat$L)))
  
  fig <- fig +
    geom_line(data=tmp, aes(x=x,y=y),linetype="dashed") +
    geom_line(data=tmp, aes(x=x, y=C*x^-0.75)) #+
  #geom_line(data=tmp, aes(x=x, y=C2/x), linetype="dotted")
  
  fig <- fig +
    xlab(TeX("Asymptotic length, $\\textit{L}_{\\infty}$ (cm)")) + 
    ylab(TeX("von Bertalanffy coefficient, $\\textit{K}$ (1/yr)"))
  fig <- loglog(fig, ylim=c(0.03, 3))
  
  ggsave("TeX/ChapterIndividual/KvsLinf.pdf",width=singlewidth,height=singlewidth)
  fig
}

plotA <- function() 
{
  dat <- getGrowthParameters()
  
  fig <- ggplot() +
    geom_point(data=dat, aes(x=W, y=A), colour=grey(0.3))
  
  # fit
  fit <- lm(log(A) ~ log(W), data=dat)
  tmp <- data.frame(x=dat$W, y=exp(predict(fit)))
  fig <- fig + geom_line(data=tmp, aes(x=x,y=y),linetype="dashed")
  cat("Fit to A, coef.: ", exp(fit$coefficients[1]), ", exponent: ", fit$coefficients[2],'\n')
  
  # Mean value:
  Amean <- exp(mean(log(dat$A)))
  cat("Amean ",Amean,"\n")
  fig <- fig + 
    geom_line(data=data.frame(x=c(min(dat$W), max(dat$W))), 
              aes(x=x, y=Amean)) #+
  #
  # Finalize figure
  #
  fig <- fig +
    theme(legend.position=c(1,0), legend.justification=c(1,0)) +
    scale_colour_grey()+ 
    xlab(TeX("Asymptotic weight, $\\textit{W}_{\\infty}$ (g)")) + 
    ylab(TeX("Growth coef. $\\textit{A}$ ($g^{1/4}$/yr)")) +
    labs(colour="",shape="")
  fig <- loglog(fig)  
  
  ggsave("TeX/ChapterIndividual/A.pdf", width=singlewidth, height=height)
  fig
}


panelEtam <- function()
{
  p <- baseparameters()
  # 
  # etam
  # 
  data <- read.csv("Data/fecundpruned.csv",header=TRUE,sep=",")
  data$Winf <- data$aW * data$Linf^data$bW
  data$Wm  <- data$aW * data$Lm^data$bW
  data$etam <- data$Wm/data$Winf
  data$Phylum <- ifelse(data$phyl=="t","Teleosts","Elasmobranchs")
  levels(data$Phylum) <- c("Elasmobranchs", "Teleosts")
  
  loglogpanel(xlim=data$Winf, ylim=c(0.01,2),
              xlab="Asymptotic weight $\\textit{W}_{\\infty}$ (g)", 
              ylab="Rel. maturation size, $\\textit{\\eta}_\\textit{m}$",
              label=TRUE)
  ixElasmo = data$Phylum=="Elasmobranchs"
  ixTele = data$Phylum=="Teleosts"
  points(data$Winf[ixElasmo], data$etam[ixElasmo], pch=dots, col=stdgrey)
  points(data$Winf[ixTele], data$etam[ixTele], pch=dots)
  #
  # Fits
  # 
  
  # all:
  fit <- lm(log(etam) ~ log(Winf), data=data)
  #tmp <- data.frame(x=data$Winf, y=exp(predict(fit)))
  #fig <- fig + geom_line(data=tmp, aes(x=x,y=y),linetype="dashed")
  lines(range(data$Winf), exp(fit$coefficients[1])*range(data$Winf)^fit$coefficients[2],
        lty=dashed, lwd=3)  
  # teleosts:
  ix <- data$Phylum=="Teleosts"
  fitfish <- lm(log(Wm[ix]/Winf[ix]) ~ log(Winf[ix]), data=data)
  tmp <- data.frame(x=data$Winf[ix], y=exp(predict(fitfish)))
  #fig <- fig + geom_line(data=tmp, aes(x=x,y=y), linetype="dotted")
  # teleosts with exponent 1:
  etam <- exp(mean(log(data$Wm/data$Winf)))
  cat('Average eta_m',etam,'\n')
  lines(range(data$Winf), etam*c(1,1), lwd=3)
  
  legend("bottomright", bty="n", 
         legend=c("Teleosts", "Elasmobranchs"),
         pch=c(dots,dots),
         col=c("black", stdgrey))
}

panelOgive <- function() {
  ogive <- as.matrix(read.table(file="Data/maturity_saithe.dat", header=FALSE, skip=5))
  weights <- as.matrix(read.table(file="Data/weightatage_saithe.dat", header=FALSE, skip=5))
  
  weights[weights==0] <- max(weights)
  nages <- dim(weights)[1]
  nyears <- dim(weights)[2]
  dat <- data.frame(weight=log(as.vector(weights)), ogive=as.vector(ogive), 
                    year=rep(seq(1,nyears),nages))
  dat$ogive[ogive==0] <- NaN
  dat$ogive[ogive==1] <- NaN
  dat$ogive.logit <- qlogis(dat$ogive)
  
  dat$year = factor(dat$year)
  
  m = glm( ogive.logit ~ 0 + year + weight, data=dat )
  
  semilogxpanel(xlim=c(0.1,10), ylim=c(0.01,1),
                xlab="\\textit{w}/\\textit{w}_{maturation}", 
                ylab="Maturity",
                label=TRUE)
  
  for(i in 1:nyears) {
    ix = dat$year==i
    points(exp(dat$weight[ix]+coef(m)[i]/coef(m)[nyears+1]), dat$ogive[ix], pch=dots, col=stdgrey)
  }
  w = 10^seq(-2,1, length.out = 100)
  lines( w, psi(w, coef(m)[nyears+1]) , lwd=3)  
  vline(1)
  
  print(coef(m)[nyears+1])
}

plotMaturity <- function() {
  defaultplot(mfcol=c(1,2))
  panelEtam()
  panelOgive()
  
}

plotR <- function()
{
  #
  # Use gunderson data
  #
  p <- baseparameters()
  A <- read.csv("Data/Gunderson.csv", header = TRUE, sep = ",")
  A$Winf <- weight(A$Linf)
  
  # Estimate A from age at maturation + 0.5:
  A$A <- p$etaM^0.25/((1-p$n)*(A$alpha+0.5))*A$Winf^(1-p$n) #log(1-p$etaM^0.25*p$etaA) / (-0.25*p$etaA*(A$alpha+0.5) ) * A$Winf^(1-p$n)
  
  fig <- ggplot(data=A) +
    geom_point(aes(x=Winf, y=GSI/A), colour=grey(0.3))
  
  # all:
  fit <- lm(log(GSI/A) ~ log(Winf), data=A)
  tmp <- data.frame(x=A$Winf, y=exp(predict(fit)))
  fig <- fig + geom_line(data=tmp, aes(x=x,y=y),linetype="dashed")
  cat('Fit to R', fit$coefficients,'\n')
  
  epsA <- exp(mean(log(A$GSI/A$A*A$Winf^0.25)))
  cat('eps_repro = ', epsA, '.\n')
  
  fig <- fig + 
    geom_line(aes(x=Winf, y=Winf^(p$n-1))) +
    geom_line(aes(x=Winf, y=Winf^(p$n-1)*epsA)) +
    xlab(TeX("Asymptotic weight, $\\textit{W}_{\\infty}$ (g)")) + 
    ylab(TeX("Repro. output  ($g^{-0.25}$)"))
  
  fig <- loglog(fig)
  ggsave("TeX/ChapterIndividual/R.pdf", width=singlewidth, height=height)
  fig
}  


plotGrowth <- function()
{
  #
  # Plot some growth functions
  #
  library(deSolve)
  width = 10
  height = 6
  
  W = 2000
  fig <- ggplot()
  p <- baseparameters()  
  p$W <- W
  # Add my growth curve:
  #n <- p$n
  #epsA <- p$etaA
  etaM <- p$etaM
  A <- p$A
  
  # Interval:
  CV = 1.95 # Estimated as exp(sqrt(var(log(dat$A)))) in plotA.R
  ages = seq(0,50,length.out=500)
  p1 <- p
  p1$W <- p$W*0.8
  p1$A <- p$A/CV
  p2 <- p
  p2$W <- p$W/0.8
  p2$A <- p2$A*CV
  out1 <- ode(y=p$w0, times=ages, func=function(t,w,p) list(growth(p,w)), parms=p1)
  out2 <- ode(y=p$w0, times=ages, func=function(t,w,p) list(growth(p,w)), parms=p2)
  
  fig <- fig + 
    geom_ribbon(aes(x=out1[,1], ymin=out1[,2], ymax=out2[,2]),
                fill=grey(0.5))
  
  # Add observed von Bertalanffy curves:
  dat <- getGrowthParameters()
  
  ix <- dat$W>0.8*W & dat$W<(1/0.8)*W
  
  ages <- seq(0,50, length.out = 150)
  for (i in 1:sum(ix)) {
    w <- weight( (dat[ix,]$L[i]*(1-exp(-dat[ix,]$K[i]*ages))) )
    fig <- fig + 
      geom_line(data=data.frame(x=ages,y=w),
                aes(x=x,y=y), size=thin, colour=grey(0.75))
  }
  # "Median" line
  out <- ode(y=p$w0, times=ages, func=function(ages,w,p) list(growth(p,w)), parms=p)
  fig <- fig + 
    geom_line(aes(x=out[,1],y=out[,2]), size=1) +
    geom_hline(yintercept=etaM*W, linetype="dotted",size=thin) +
    geom_vline(xintercept = ageMaturation(W=W), linetype="dotted",size=thin)
  
  fig <- fig +
    xlab("Age (yr)") + 
    ylab("Weight (g)") +
    scale_x_continuous(limits=c(0,0.5*A*W^0.25), oob=rescale_none) +
    scale_y_continuous(oob=rescale_none)
  fig <- mytheme(fig)
  
  ggsave("TeX/ChapterIndividual/Growth.pdf",width=width, height=height, units="cm")
  fig
}


plotBudget <- function()
{
  p <- baseparameters()
  W <- 1
  eta <- 0.001
  A <- p$A
  h <- p$h
  n <- p$n
  epsEgg <- p$epsEgg
  etaM <- p$etaM
  
  k  = A*W^(n-1)
  maxrate = A*W^n
  dat = data.frame(w = 10^seq(from=log10(eta*W), to=log10(W), length.out=100))
  dat$psi = (1 + (dat$w/(etaM*W))^(-10))^(-1)
  
  fig <- ggplot() +
    # consumption:
    geom_line(data=dat, aes(x=w, y=p$f0*h*w^n/maxrate), size=thick) +
    # consumption minus egestion and excretion:
    geom_ribbon(data=dat, aes(x=w, ymax=(1-0.15-0.1)*p$f0*h*w^n/maxrate, 
                              ymin=0.01/maxrate), fill=grey(0.9)) +
    # available energy
    geom_ribbon(data=dat, aes(x=w, ymax=A*w^n/maxrate, ymin=0.01/maxrate), 
                fill=grey(0.8)) +
    geom_line(data=dat, aes(x=w, y=A*w^n/maxrate)) +
    #geom_ribbon(data=dat, aes(x=w, ymax=(A*w^n-epsR*k*w)/maxrate, 
    #                          ymin=0.01/maxrate), fill=grey(0.6)) +
    # Reproductive out:
    geom_ribbon(data=dat, 
                aes(x=w, ymax=(A*w^n-(1-epsEgg)*psi*k*w)/maxrate, ymin=0.01/maxrate), 
                fill=grey(0.6)) +
    # Reproductive output:
    #geom_ribbon(data=dat, 
    #            aes(x=w, ymax=(A*w^n-epsR*psi*k*w)/maxrate, ymin=0.01/maxrate), 
    #            fill=grey(0.4)) +
    # Growth
    #geom_line(data=dat, aes(x=w, y=(A*w^n-psi*k*w)/maxrate), linetype="dashed") +
    geom_ribbon(data=dat, 
                aes(x=w, ymax=(A*w^n-psi*k*w)/maxrate, ymin=0.01/maxrate), 
                fill=grey(0.2)) +
    #geom_line(data=dat, aes(x=w, y=(A*w^n-(1-epsEgg)*psi*k*w)/maxrate), 
    #          linetype="dashed", size=thick) +
    geom_vline(xintercept = etaM, linetype="dotted", size=thin) +
    xlab(TeX("Relative body weight $(\\textit{w}/\\textit{W}_{\\infty})$")) + 
    ylab("Normalized rates")
  fig <- loglog(fig, xlim=c(0.01,1), ylim=c(2e-2,3)) 
  
  # W <- 1
  # fig2 <- ggplot() +
  #   geom_line(data=dat, aes(x=w, 
  #       y=((0.15*p$f0 + p$fc*p$epsA)*p$h*w^p$n + psi*(1-p$epsEgg)*A*W^(p$n-1)*w) / w^p$n)) +
  #   geom_line(data=dat, aes(x=w, A*W^(p$n-1)*w / w^p$n), size=0.5)
  # fig2 <- semilogx(fig2)
  # fig2
  
  ggsave("TeX/ChapterIndividual/budget.pdf",width=singlewidth, height=height)
  fig
}

plotTestGrowth <- function(K, Linf)
{
  p <- baseparameters()
  A <- calcA(K,Linf)
  p$A <- A
  W <- weight(Linf)
  p$W <- W
  t <- seq(0,30,length.out = 100)
  cat(A,'\n')
  
  out <- ode(y=p$w0, times=t, func=function(t,w,p) list(growth(p,w)), parms=p)
  
  fig <- ggplot() +
    geom_line(aes(x=t, y=weight(Linf*(1-exp(-K*t))))) +
    geom_line(aes(x=t, y=(0.25*p$A*t + p$w0^0.25)^4)) +
    geom_hline(yintercept = p$etaM*W) +
    geom_line(aes(x=out[,1], y=out[,2])) +
    ylim(c(0, W))
  fig
}


plotAllChapterIndividual <- function()
{
  pdfplot("TeX/ChapterIndividual/vonB2.pdf", plotSketch_and_vonB, width=doublewidth, height=height)
  plotKvsLinf()
  plotA()
  pdfplot("TeX/ChapterIndividual/maturity.pdf", plotMaturity, width=doublewidth, height=height)
  plotR()
  plotGrowth()
  plotBudget()
  
}
```


# 目的
- 個体の成長と再生産を表現する
  - Size spectrum theoryを個体群まで発展させるため、個体について詳細に記述する
  - エネルギー収支（Energy budget)をサイズ(w)の関数とし、摂餌率(consumption rate)から成長・再生産率を記述
  - これにより**個体が獲得したエネルギーをどう利用するか**を記述
- 極限サイズをMaster traitの確立
  - シンプルで広く使われているvon Bertalanffyの成長モデル（以下,vBモデル）をベースに成長モデルを構築する
  - シンプルな理論の構築にはパラメータは少ないほうが良い
  - Life history invariants（魚種間で”systematically”に変動しないパラメータ）を使い、not invariantな（魚種間で変動する）パラメータを絞る
  - 最終的にパラメータは極限サイズに絞られる
  - これは魚類の生活史パターンの殆どを特徴づけることができるMaster traitとなる 
- 個体サイズ、極限サイズ、生活史パラメータに関係づけてエネルギー収支を記述
  - 成長と再生産だけでなく、消化と代謝による損失も考慮
  - エネルギー収支は、個体の適応度を最適化するための生活史最適化の枠組みで決定する
  - 生活史パラメータの多くは経験的な値に頼る

# 3.1 The von Bertallanffy growth model
- VBモデルは成熟にかかるコストを明確に取り入れていないが、本書の後の章では、成熟コストの考慮が必要となる
- 本章では、成熟前と成熟後の異なる成長様式を一つのモデルで記述する(Biphasic growth model)
  - 成熟前：エネルギーをすべて成長に使う
  - 成熟後：エネルギーを成長と再生産に使う

- 最初に、ベースとなるvBモデルを詳しく見る

# vBモデル:1
<div align = "left">
- 同化作用(anabolic)と異化作用(catabolic)のプロセスから構成される

$$
\frac{dw}{dt}= Aw^n-kw\tag{3.4}
$$

  - $Aw^n$ :エネルギーの獲得(accuisition, anabolic) 
  - $kw$  :エネルギーの損失(losses, catabolic)　

- いずれも体重のべき乗（指数nと１）に比例する

- nについて
  - エネルギーの獲得は同化作用の過程によって決まる
  - 同化作用は胃や腸など組織の表面積からの、酸素や食料の吸収と解釈
  - シンプルな2/3乗則に従うと考えた


# vBモデル:２
<div align = "left">
(3.4)式は、$w=cl^3$の関係を使って$K= k/3$, $L_\infty=c^{-1/3}Ak$とおくと3.5式のように変形できる（see BOX3.1)

$$
\frac{dl}{dt} = K(L_\infty-l)\tag{3.5}
$$

両辺を積分して解くと

$$
l(t) = L_\infty(1-e^{-K_t})\tag{3.6}
$$

- $L_\infty$：asymptotic length: 極限体長 
- $K$：growth constant（時間あたり）

$K$と$A$、$L_\infty$は $n = 2/3$のとき以下の関係が成り立つ

$$
K=\frac{A}{3c^{1/3}}\frac{1}{L_\infty}\tag{3.7}
$$

# 図3.1a
初期の成長は傾き$KL_\infty$の直線似近く（斜めの破線）、$l$が$L_\infty$に近づくと成長が止まる（横の破線）
```{r 3.1a, fig.height=4, fig.width =8}

plotSketch_and_vonB()
```

<!--
## Box3.1 Length and Weight-based vB model
<div align ="left">
3.4式を$w=cl^3$を用いて変形すると

$$
\frac{dw}{dt}=\frac{dcl^3}{dt}=3cl^2\frac{dl}{dt}=Aw^n-kw
$$




$$
\frac{dl}{dt} = \frac{1}{3cl^3}A(cl^3)^n-\frac{kcl^3}{3cl^3}
$$



ここでn=2/3 ならば
$$
\frac{dl}{dt}=\frac{1}{3}C^{-1/3}A-\frac{k}{3}l =\frac{k}{3}\bigl(\frac{c^{-1/3}A}{k}-l\bigr)
$$

$K=\frac{k}{3}$,  $L_\infty = \frac{c^{-1/3}A}{k}$ とおけば、3.5式と同じになる。

-->


# vBモデルの問題
- $K$と$L_\infty$に相関関係がある（図3.2）
	- $L_\infty$の誤差は$K$に影響（いっぽうが過大推定→もう一方は過小推定）
	- $L_\infty$の不確実性は高い
- Aを確かな筋から推定できれば、$L_\infty$の不確実性の$K$への影響を弱められるだろう

- nは3/4のほうがいい
	- West(1997)は、代謝を表す体重のべき数に3/4乗則を採用した
- 本章でもn=3/4を採用する 

# 図3.2　Kと$L_\infty$　の関係
- $K$ と$W_\infty$の関係を、既往の知見で得られている実測値によって示した。
- モデルを$K = CL_\infty^{-n}$として、破線はnとCを推定した場合、実線はn＝0.75に固定した場合。水温15℃での成長になるよう調整
```{r g3.2, fig.height=4, fig.width =5}
plotKvsLinf()
```



# 3.2 Asymptotic size as a mster trait
<div align ="left">

- vBモデルはエネルギーの獲得（$AW^n$)と損失($kw$)の関係が年齢・サイズによって変化することで形が決まる
- 年齢・サイズが大きくなると、繁殖による損失が大きくなり、成長にエネルギーが回らなくなる（図3.1b）

- $A$,$k$,$W_\infty$の関係は3.11式のように書ける

$$
W_\infty=\bigl(\frac{A}{k}\bigr)^\frac{1}{1-n}\tag{3.11}
$$

- (3.4)式と(3.11)式から(3.12)式が導ける。

$$
\frac{dw}{dt}=Aw^n\bigl[1-\bigl(\frac{w}{W_\infty}\bigr)^{1-n}\bigr]\tag{3.12}
$$
この式により、魚種による成長の違いは$A$と$W_\infty$だけで記述可能となった

# 図3.1b
- 個体の体重と獲得エネルギーの関係。太い実線が$Aw^n$,細い実線が$kw$。
- 右側の縦の破線は極限サイズ＝10kgの魚種の場合で、獲得エネルギーと損失エネルギーが等しくなったところで成長が止まる

```{r g3.1b, fig.height=3, fig.width = 7}
plotSketch_and_vonB()
```


# $A$について
<div align ="left">
- $A$(Growth coefficient) はエネルギーの獲得と同化のプロセスを表現する
- このプロセスは種の極限体長とは関係しないと期待できる。
- vBモデルで推定された$K$ と$L_\infty$の値を用い、BOX3.2の（3.10）式に基づき$A$を決定する（図3.3, BOX3.2）
- $A$ は$W_\infty$に対して変動幅大きくやや増加傾向だが、単純のため$A$はinvariant（$≒5.35g^{0.25}/yr$)として扱う。


# 図 3.3
既往の知見で得られた$W_\infty$と$A$の関係。実線は$A$の相乗平均、破線は指数関数を当てはめた場合（指数は0.053）

```{r g3.3}
plotA()
```

<!--
## BOX3.2
$KL_\infty$とAの関係は、n=2/3で確認されているのであるが、box3.2から、n=3/4でも概ねOK。
-->

# Biphasic growth equation
<div align ="left">
- vBモデルから発展

- 再生産にかかるコストを考慮するため、獲得エネルギーの全部を成長に使う稚幼魚期と、繁殖にも使う成魚期の成長を区別した上で統合

- 初回成熟時の体重（$w_m$）の$W_\infty$に対する比率を$\eta_m$とすると

  - 稚魚期の成長($w<\eta_mW_\infty$のとき）: $g_j(w) = Aw^n$

  - 成魚の成長($w>\eta_mW_\infty$のとき）  : $g(w) = Aw^n-kw$

$\eta_m$は図3.4aからinvariant と仮定

# 図3.4
- a: $W_\infty$と$\eta_m$の関係。$\eta$はinvariantとみてよい（データはOlsson and Gislason(2016）
- b:North sea saitheの成熟曲線。3.15式を当てはめた。3.15式のuを5と見積もった（データはICES資源評価から）

```{r g3.4, fig.height=3, fig.width =7}
plotMaturity()
```


# 成熟関数の導入
<div align = "left">
- 両ステージをつなぐため、関数$\psi_m(w/w_m)$を導入

$$
\psi_m(w/w_m) = \bigl[1+\bigl(\frac{w}{w_m}\bigr)^{-u}\bigr]^{-1}=\bigl[1+\bigl(\frac{w}{\eta_mW_\infty}\bigr)^{-u}\bigr]^{-1}\tag{3.15}
$$

- $\psi(w/w_m)$は、$w\ll w_m$ではゼロに、$w\gg w_m$では1に近づく

- uはその変化の強さを決めるパラメータ（図3.4b＝steepnessを決める）

- 成熟関数を導入することにより、両ステージを一つの式で記述
$$
g_{bp}(w)=Aw^n-\psi_m(w/w_m)kw\tag{3.16}
$$

- ここで3.11式を変形した3.17式を使うと、成長式は3.18式のように書ける
$$
k=AW_\infty^{n-1}\tag{3.17}
$$


$$
g_{bp}(w) = Aw^n\bigl[1-\psi\bigl(\frac{w}{\eta_mW_\infty}\bigr)\bigl(\frac{w}{W_\infty}\bigr)^{1-n}\bigr]\tag{3.18}
$$


# 図3.6

- Biphasic modelは年齢あたり体重を解析的に解くことができないが、幼魚期の部分だけとりだせば解析的に解くことができる（Box3.3）
- 数値計算的に説いた例は図3.6に示す

vBモデルと、数値解析的に説いたBiphasic growth modelの比較
```{r g3.6}
plotGrowth()
```


<!--
## BOX3.3
Biphasic modelは解析的に解けないが、幼魚期の部分だけとりだせば解析的に解くことができる（Box3.3）
-->

# Biphasic model について

- 繁殖への投資(investment in reproduction)を考慮した

- 繁殖の$W_\infty$に対するスケールが示される

- 繁殖への投資の指数はマイナス（3.17式）となり$W_\infty$が大きくなると体重あたりの繁殖への投資は減少する。これは観測に一致する（図3.5）

- 繁殖投資（$kw$）は卵生産だけでなく他の繁殖に関わる投資（産卵回遊など）も含む

- 卵生産以外の繁殖に要するエネルギーも産卵量（$R_{egg}$:個体あたり時間あたり卵量）に比例する

$$
R_{egg} = \varepsilon_{egg}kw = \varepsilon_{egg}AW^{n-1}_\infty
$$

$\varepsilon_{egg}$ (再生産効率:reproductive efficiency)はinvariantであり、図3.5から0.22に近似できる

# 図3.5
- $W_\infty$とReproductive outputの関係。この関係から$\varepsilon_a$ ≒0.22と見積もった。
- GSI/Aをreproductive output としている。データはGunderson(1997)


```{r g3.5}
plotR()
```


# 3.2のまとめ

- パラメータ（$A$,　$\varepsilon_{egg}$, $\eta_m$, $n$）はinvariantとする

- 魚種による違いを表現するmaster traitとして極限サイズ$W_\infty$ を採用

- これにより小型魚から大型魚まで含めたgeneral statementを作ることができる。

- $W_\infty$以外の形質について種特異的な値を用いれば、種特異的な、より正確な成長式が得られる


$$
g_{bp}(w) = Aw^n\bigl[1-\psi\bigl(\frac{w}{\eta_mW_\infty}\bigr)\bigl(\frac{w}{W_\infty}\bigr)^{1-n}\bigr]\tag{3.18}
$$

# 3.3 Bioenergetic formulaton of the growth equation
<div align = "left">
- Biphasic growth modelは２章で構築した生理学に基づく過程とどう結びつくか？

- vBモデルのエネルギー収支の考えは単純すぎる：エネルギー獲得過程でのロスを考慮していない、$kw$で表現している損失は主に再生産

エネルギー代謝を数式で表現すると
$$
C(w)=M_{assim}(w) + M_{std}(w) +M_{act}(w) + R_{egg}(w)/\varepsilon_{egg}+g(w)\tag{3.26}
$$

ここで

$C$ :consumption,   $M_{assim}$:  assimilation, $M_{std}$: standard metabolism,   $M_{act}$ :activity

$R_{egg}/\varepsilon_{egg}$:reproduction,  $g$:growth


# Consumption and assimilation

- 2章において摂餌率を　$C(w) = f_0hw^n$ (2.18式)と記述
- 摂餌レベル$f_0$ は最大摂餌レベル$hw^n$の一部→ 摂餌～同化のあいだに損失がある
  - エネルギーに使用されない損失＝排泄（egestion:消化器系による排泄+excreation:血液系による排泄）
  - 消化吸収のための代謝（$M_{assim}$)による損失

- これらは摂餌量に比例する。

Kitchell el al.(1977)は消化行動で15％、egestionで15％、excreationで10％のロスがあると見積もった。

これらの損失を係数$\varepsilon_a$として、2章の2.18式にかけると、同化量は以下のように書ける。

$$
C_{assim}(w) = \varepsilon_af_0hw^n　＝C(w)-M_{assim}\tag{3.27}
$$

# Standard metabolism and activity

- 基礎代謝は $M_{std} = k_sw^n$ と書ける

- activityによる代謝$M_{act}$は見積もりが難しいので、$M_{std}$に比例するとして$M_{std}$と合わせて考える

- $M_{std}+M_{act}$は最大摂餌率$hw^n$に比例すると考え、$k_s = f_c\varepsilon_ah$ （$f_c$は限界摂餌レベル）として

$$
M_{std}(w) + M_{act} = f_c\varepsilon_ahw^n\tag{3.28}
$$


$f_c$ はinvariant とし、Hartvig et al(2011)により約0.2とする。



# ふたたび$A$について
<div align = "left">
3.26 式を書き換えて成長を表すようにまとめると、
$$
g(w) = \varepsilon_af_0hw^n -f_c\varepsilon_ahw^n-\psi(w/w_m)kw\tag{3.29}
$$

$$
g(w) = \varepsilon_ah(f_0-f_c)w^n-\psi(w/w_m)kw\tag{3.30}
$$



となり、$A$は以下のように書ける
$$
A=\varepsilon_ah(f_0-f_c)\tag{3.31}
$$

$\varepsilon_a, f_0, fc, h$　の定数は invariantsなので、理論的にも$A$はinvariantと考えることができる。 

図3.8にそれぞれのエネルギーの関係を示した

## 図3.8
```{r g3.8}
plotBudget()
```

# 3.4 Which other traits describe fish life histories?

- 3.11式は$W_\infty$ 、 $A$、$k$ の関係を示している。$W_\infty$ではなく$k$をMaster trait とすることもできるが、$W_\infty$には利点がある

  - 使いやすく推定が楽。
  - data-limitedな資源でも推定可能
  - 直感的（intuitive)にわかりやすい

- $W_{\infty}$と$A$  からの他のパラメータを決められる？

  - 理論的には正しいが、データからは明確に示せていない
  - invariant として扱ったパラメータはinvariantか？ 例えば$W_\infty$ と$W_m$ (成熟サイズ) の比（$\eta_m$)は種によってかなり異なるが


# 検討
- "Invariant”とは”種によらず一定"ということではない
  - 他の形質（成長速度、水温などの環境、系統発生学的な位置関係）と”co-vary”ではない
  - invariantとされる形質の魚種による変動はランダムで、予測不能である

- データの限界
  - パラメータのいくつかは直接推定されていない。考慮してできていないバイアスがある可能性
  - 既往のvBモデルは1個体の成長ではなく平均的なもの→現実の個体の成長を表していない
  - 繁殖への投資などは推定自体難しい
  
- 魚種間の変動に関わる形質を考慮できていない
  - 候補の形質はslow-fast life history continuum と防御にかかるコスト
  - 考慮すべき形質が増えるとモデルは複雑になる→意味のある改善がみとめられない限り、考慮すべき形質は少ないほうが良い

- 最小モデルのMaster traitとして極限サイズを用いることとする。

# 3.5 Summary

- この章で構築したモデルは、成長と再生産（繁殖）が、極限サイズが異なる魚種間でどのように変化するかを示す。成長に関する様々なことを、invariantなパラメータのセットと極限サイズで説明できる。

- パラメータは魚種間で必ずしも一定ではないが、極限サイズとの関係においてsystematicな変動はないので、極限サイズを Master traitとすることができる。

- 問題点
  - vBのモデルとは一致しない：Juvenile stageでの予測値が小さくなる
  - 吸収と基礎代謝による損失においてn=3/4を用いたため。3/4より大きい可能性があり、改善の余地がある
  
- 本章のモデルは完璧ではなく、精度を犠牲にしている。しかしシンプルな理論構築のため、一つのMaster trait（$W_\infty$）によるシンプルなモデルを構築するという本章の目的をよく果たすといえる。精度を犠牲にしたことによって得られる恩恵を、後の章で受けることになる。


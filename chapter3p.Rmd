---
rtitle: "Chapter 3"
subtitle: Individual Groth and Reproduction
author: 担当 渡邊
date: 2020/6/8
output:
  revealjs::revealjs_presentation:
    theme: white
    self_contained: false
    transition: none 
    highlight: pygments
    #default fade slide convex concave zoom none
    reveal_options:
      #autoSlide: 5000
      width: 960
      height: 720
      control: true
      progress: true
      slideNumber: true
      previewLinks: true
      history: false
      overview: true
      center: false
      left: true
      mouseWheel: false
    fig_width: 6
    fig_height: 3.5
    fig_caption: false
    #css: "for-revealjs.css"
    #mathjax: local
    #reveal_plugins: ["notes"] #search
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, cache = F, eval = T)
knitr::opts_knit$set(root.dir = normalizePath("C:/RWD/FEEread"))
```


```{r code, include = FALSE}
library(fishsizespectrum)
source("R/basetools.R")

#dir.create("TeX/ChapterIndividual")

getGrowthParameters <- function()
{
  data <- read.csv("Data/fecundpruned.csv",header=TRUE,sep=",")
  data$Winf <- data$aW * data$Linf^data$bW
  data$Wm  <- data$aW * data$Lm^data$bW
  data$Phylum <- data$phyl
  levels(data$Phylum) <- c("Elasmobranchs", "Teleosts")
  #
  # Data from Kooijman and Gislason:
  #
  data2 = read.csv("Data/KooijmanGislason.csv", header=FALSE, col.names=c("K","Linf","T"))
  #
  # Combine data for fish
  # 
  Q10 <- 1.83
  ix  <- data$Phylum == "Teleosts"
  dat <- data.frame(K=data$K[ix] * Q10^((15-data$T[ix])/10), 
                    W=data$Winf[ix])
  dat2 <- data.frame(K=data2$K * Q10^((15-data2$T)/10), W=0.01*data2$Linf^3)
  dat = rbind(dat, dat2)
  
  p <- baseparameters()
  dat$L <- (dat$W/p$c)^(1/3)
  
  dat$A = calcA(dat$K, dat$L)
  
  dat
}

panelvonB <- function()
{
  #
  # Sketch of von B curve
  # 
  Linf <- 100
  K <- 0.18
  
  ages = seq(0,30,length.out=100)
  
  defaultpanel(xlim=ages, ylim=c(0,c(0,110)),
               xlab="Age (years)",
               ylab="Length (cm)",
               label=TRUE)
  lines(ages, Linf*(1-exp(-K*ages)), lwd=3)
  lines(ages, y=K*Linf*ages, lty="dashed", lwd=1)
  lines(x=ages, y=Linf*ages/ages, lty="dashed", lwd=1)
}

panelSketch <- function()
{
  #
  # Sketch of Winf
  # 
  xlim = c(1e-11,1e5)
  ylim = c(5e-10,1e6)
  p <- baseparameters()
  
  n <- p$n
  W1 = 10
  W2 = 10000
  A <- p$A
  k = function(W) A*W^(n-1)
  
  w=10^seq(from=-3, to=6, length.out=100)
  Ea = A

  loglogpanel(xlim=w, ylim=A*w^n, 
              xlab="Body weight (g)", 
              ylab="Available energy, $E_a$ (g/yr)",
              label=TRUE)
  lines(w, A*w^n, lwd=3)
  
  ix = w<10*W1
  lines(w[ix], k(W1)*w[ix])
  lines(W1*c(1,1), c(1e-4,6*W1^n), lty=dashed)

  ix = w<10*W2
  lines(w[ix], k(W2)*w[ix])
  lines(W2*c(1,1), c(1e-4,6*W2^n), lty=dashed)
}


plotSketch_and_vonB <- function()
{
  defaultplot(mfcol=c(1,2))
  panelvonB()
  panelSketch()
}


plotKvsLinf <- function()
{
  dat <- getGrowthParameters()
  
  fig <- ggplot() +
    geom_point(data=dat, aes(x=L, y=K), colour=grey(0.3))
  # fit
  fit <- lm(log(K) ~ log(L), data=dat)
  tmp <- data.frame(x=dat$L, y=exp(predict(fit)))
  cat('Fit of K: C = ', exp(fit$coefficients[1]), 
      ' and exponent ', fit$coefficients[2], "\n")
  
  # fit with exponent -0.75:
  C <- exp(mean(log(dat$K * dat$L^0.75)))
  cat('K fitted wit n=0.75: ', C, "\n")
  
  # fit with exponent -1:
  C2 <- exp(mean(log(dat$K * dat$L)))
  
  fig <- fig +
    geom_line(data=tmp, aes(x=x,y=y),linetype="dashed") +
    geom_line(data=tmp, aes(x=x, y=C*x^-0.75)) #+
  #geom_line(data=tmp, aes(x=x, y=C2/x), linetype="dotted")
  
  fig <- fig +
    xlab(TeX("Asymptotic length, $\\textit{L}_{\\infty}$ (cm)")) + 
    ylab(TeX("von Bertalanffy coefficient, $\\textit{K}$ (1/yr)"))
  fig <- loglog(fig, ylim=c(0.03, 3))
  
  ggsave("TeX/ChapterIndividual/KvsLinf.pdf",width=singlewidth,height=singlewidth)
  fig
}

plotA <- function() 
{
  dat <- getGrowthParameters()
  
  fig <- ggplot() +
    geom_point(data=dat, aes(x=W, y=A), colour=grey(0.3))
  
  # fit
  fit <- lm(log(A) ~ log(W), data=dat)
  tmp <- data.frame(x=dat$W, y=exp(predict(fit)))
  fig <- fig + geom_line(data=tmp, aes(x=x,y=y),linetype="dashed")
  cat("Fit to A, coef.: ", exp(fit$coefficients[1]), ", exponent: ", fit$coefficients[2],'\n')
  
  # Mean value:
  Amean <- exp(mean(log(dat$A)))
  cat("Amean ",Amean,"\n")
  fig <- fig + 
    geom_line(data=data.frame(x=c(min(dat$W), max(dat$W))), 
              aes(x=x, y=Amean)) #+
  #
  # Finalize figure
  #
  fig <- fig +
    theme(legend.position=c(1,0), legend.justification=c(1,0)) +
    scale_colour_grey()+ 
    xlab(TeX("Asymptotic weight, $\\textit{W}_{\\infty}$ (g)")) + 
    ylab(TeX("Growth coef. $\\textit{A}$ ($g^{1/4}$/yr)")) +
    labs(colour="",shape="")
  fig <- loglog(fig)  
  
  ggsave("TeX/ChapterIndividual/A.pdf", width=singlewidth, height=height)
  fig
}


panelEtam <- function()
{
  p <- baseparameters()
  # 
  # etam
  # 
  data <- read.csv("Data/fecundpruned.csv",header=TRUE,sep=",")
  data$Winf <- data$aW * data$Linf^data$bW
  data$Wm  <- data$aW * data$Lm^data$bW
  data$etam <- data$Wm/data$Winf
  data$Phylum <- ifelse(data$phyl=="t","Teleosts","Elasmobranchs")
  levels(data$Phylum) <- c("Elasmobranchs", "Teleosts")
  
  loglogpanel(xlim=data$Winf, ylim=c(0.01,2),
              xlab="Asymptotic weight $\\textit{W}_{\\infty}$ (g)", 
              ylab="Rel. maturation size, $\\textit{\\eta}_\\textit{m}$",
              label=TRUE)
  ixElasmo = data$Phylum=="Elasmobranchs"
  ixTele = data$Phylum=="Teleosts"
  points(data$Winf[ixElasmo], data$etam[ixElasmo], pch=dots, col=stdgrey)
  points(data$Winf[ixTele], data$etam[ixTele], pch=dots)
  #
  # Fits
  # 
  
  # all:
  fit <- lm(log(etam) ~ log(Winf), data=data)
  #tmp <- data.frame(x=data$Winf, y=exp(predict(fit)))
  #fig <- fig + geom_line(data=tmp, aes(x=x,y=y),linetype="dashed")
  lines(range(data$Winf), exp(fit$coefficients[1])*range(data$Winf)^fit$coefficients[2],
        lty=dashed, lwd=3)  
  # teleosts:
  ix <- data$Phylum=="Teleosts"
  fitfish <- lm(log(Wm[ix]/Winf[ix]) ~ log(Winf[ix]), data=data)
  tmp <- data.frame(x=data$Winf[ix], y=exp(predict(fitfish)))
  #fig <- fig + geom_line(data=tmp, aes(x=x,y=y), linetype="dotted")
  # teleosts with exponent 1:
  etam <- exp(mean(log(data$Wm/data$Winf)))
  cat('Average eta_m',etam,'\n')
  lines(range(data$Winf), etam*c(1,1), lwd=3)
  
  legend("bottomright", bty="n", 
         legend=c("Teleosts", "Elasmobranchs"),
         pch=c(dots,dots),
         col=c("black", stdgrey))
}

panelOgive <- function() {
  ogive <- as.matrix(read.table(file="Data/maturity_saithe.dat", header=FALSE, skip=5))
  weights <- as.matrix(read.table(file="Data/weightatage_saithe.dat", header=FALSE, skip=5))
  
  weights[weights==0] <- max(weights)
  nages <- dim(weights)[1]
  nyears <- dim(weights)[2]
  dat <- data.frame(weight=log(as.vector(weights)), ogive=as.vector(ogive), 
                    year=rep(seq(1,nyears),nages))
  dat$ogive[ogive==0] <- NaN
  dat$ogive[ogive==1] <- NaN
  dat$ogive.logit <- qlogis(dat$ogive)
  
  dat$year = factor(dat$year)
  
  m = glm( ogive.logit ~ 0 + year + weight, data=dat )
  
  semilogxpanel(xlim=c(0.1,10), ylim=c(0.01,1),
                xlab="\\textit{w}/\\textit{w}_{maturation}", 
                ylab="Maturity",
                label=TRUE)
  
  for(i in 1:nyears) {
    ix = dat$year==i
    points(exp(dat$weight[ix]+coef(m)[i]/coef(m)[nyears+1]), dat$ogive[ix], pch=dots, col=stdgrey)
  }
  w = 10^seq(-2,1, length.out = 100)
  lines( w, psi(w, coef(m)[nyears+1]) , lwd=3)  
  vline(1)
  
  print(coef(m)[nyears+1])
}

plotMaturity <- function() {
  defaultplot(mfcol=c(1,2))
  panelEtam()
  panelOgive()
  
}

plotR <- function()
{
  #
  # Use gunderson data
  #
  p <- baseparameters()
  A <- read.csv("Data/Gunderson.csv", header = TRUE, sep = ",")
  A$Winf <- weight(A$Linf)
  
  # Estimate A from age at maturation + 0.5:
  A$A <- p$etaM^0.25/((1-p$n)*(A$alpha+0.5))*A$Winf^(1-p$n) #log(1-p$etaM^0.25*p$etaA) / (-0.25*p$etaA*(A$alpha+0.5) ) * A$Winf^(1-p$n)
  
  fig <- ggplot(data=A) +
    geom_point(aes(x=Winf, y=GSI/A), colour=grey(0.3))
  
  # all:
  fit <- lm(log(GSI/A) ~ log(Winf), data=A)
  tmp <- data.frame(x=A$Winf, y=exp(predict(fit)))
  fig <- fig + geom_line(data=tmp, aes(x=x,y=y),linetype="dashed")
  cat('Fit to R', fit$coefficients,'\n')
  
  epsA <- exp(mean(log(A$GSI/A$A*A$Winf^0.25)))
  cat('eps_repro = ', epsA, '.\n')
  
  fig <- fig + 
    geom_line(aes(x=Winf, y=Winf^(p$n-1))) +
    geom_line(aes(x=Winf, y=Winf^(p$n-1)*epsA)) +
    xlab(TeX("Asymptotic weight, $\\textit{W}_{\\infty}$ (g)")) + 
    ylab(TeX("Repro. output  ($g^{-0.25}$)"))
  
  fig <- loglog(fig)
  ggsave("TeX/ChapterIndividual/R.pdf", width=singlewidth, height=height)
  fig
}  


plotGrowth <- function()
{
  #
  # Plot some growth functions
  #
  library(deSolve)
  width = 10
  height = 6
  
  W = 2000
  fig <- ggplot()
  p <- baseparameters()  
  p$W <- W
  # Add my growth curve:
  #n <- p$n
  #epsA <- p$etaA
  etaM <- p$etaM
  
  A <- p$A
  
  # Interval:
  CV = 1.95 # Estimated as exp(sqrt(var(log(dat$A)))) in plotA.R
  ages = seq(0,50,length.out=500)
  p1 <- p
  p1$W <- p$W*0.8
  p1$A <- p$A/CV
  p2 <- p
  p2$W <- p$W/0.8
  p2$A <- p2$A*CV
  out1 <- ode(y=p$w0, times=ages, func=function(t,w,p) list(growth(p,w)), parms=p1)
  out2 <- ode(y=p$w0, times=ages, func=function(t,w,p) list(growth(p,w)), parms=p2)
  
  fig <- fig + 
    geom_ribbon(aes(x=out1[,1], ymin=out1[,2], ymax=out2[,2]),
                fill=grey(0.5))
  
  # Add observed von Bertalanffy curves:
  dat <- getGrowthParameters()
  
  ix <- dat$W>0.8*W & dat$W<(1/0.8)*W
  
  ages <- seq(0,50, length.out = 150)
  for (i in 1:sum(ix)) {
    w <- weight( (dat[ix,]$L[i]*(1-exp(-dat[ix,]$K[i]*ages))) )
    fig <- fig + 
      geom_line(data=data.frame(x=ages,y=w),
                aes(x=x,y=y), size=thin, colour=grey(0.75))
  }
  # "Median" line
  out <- ode(y=p$w0, times=ages, func=function(ages,w,p) list(growth(p,w)), parms=p)
  fig <- fig + 
    geom_line(aes(x=out[,1],y=out[,2]), size=1) +
    geom_hline(yintercept=etaM*W, linetype="dotted",size=thin) +
    geom_vline(xintercept = ageMaturation(W=W), linetype="dotted",size=thin)
  
  fig <- fig +
    xlab("Age (yr)") + 
    ylab("Weight (g)") +
    scale_x_continuous(limits=c(0,0.5*A*W^0.25), oob=rescale_none) +
    scale_y_continuous(oob=rescale_none)
  fig <- mytheme(fig)
  
  ggsave("TeX/ChapterIndividual/Growth.pdf",width=width, height=height, units="cm")
  fig
}


plotBudget <- function()
{
  p <- baseparameters()
  W <- 1
  eta <- 0.001
  A <- p$A
  h <- p$h
  n <- p$n
  epsEgg <- p$epsEgg
  etaM <- p$etaM
  
  k  = A*W^(n-1)
  maxrate = A*W^n
  dat = data.frame(w = 10^seq(from=log10(eta*W), to=log10(W), length.out=100))
  dat$psi = (1 + (dat$w/(etaM*W))^(-10))^(-1)
  
  fig <- ggplot() +
    # consumption:
    geom_line(data=dat, aes(x=w, y=p$f0*h*w^n/maxrate), size=thick) +
    # consumption minus egestion and excretion:
    geom_ribbon(data=dat, aes(x=w, ymax=(1-0.15-0.1)*p$f0*h*w^n/maxrate, 
                              ymin=0.01/maxrate), fill=grey(0.9)) +
    # available energy
    geom_ribbon(data=dat, aes(x=w, ymax=A*w^n/maxrate, ymin=0.01/maxrate), 
                fill=grey(0.8)) +
    geom_line(data=dat, aes(x=w, y=A*w^n/maxrate)) +
    #geom_ribbon(data=dat, aes(x=w, ymax=(A*w^n-epsR*k*w)/maxrate, 
    #                          ymin=0.01/maxrate), fill=grey(0.6)) +
    # Reproductive out:
    geom_ribbon(data=dat, 
                aes(x=w, ymax=(A*w^n-(1-epsEgg)*psi*k*w)/maxrate, ymin=0.01/maxrate), 
                fill=grey(0.6)) +
    # Reproductive output:
    #geom_ribbon(data=dat, 
    #            aes(x=w, ymax=(A*w^n-epsR*psi*k*w)/maxrate, ymin=0.01/maxrate), 
    #            fill=grey(0.4)) +
    # Growth
    #geom_line(data=dat, aes(x=w, y=(A*w^n-psi*k*w)/maxrate), linetype="dashed") +
    geom_ribbon(data=dat, 
                aes(x=w, ymax=(A*w^n-psi*k*w)/maxrate, ymin=0.01/maxrate), 
                fill=grey(0.2)) +
    #geom_line(data=dat, aes(x=w, y=(A*w^n-(1-epsEgg)*psi*k*w)/maxrate), 
    #          linetype="dashed", size=thick) +
    geom_vline(xintercept = etaM, linetype="dotted", size=thin) +
    xlab(TeX("Relative body weight $(\\textit{w}/\\textit{W}_{\\infty})$")) + 
    ylab("Normalized rates")
  fig <- loglog(fig, xlim=c(0.01,1), ylim=c(2e-2,3)) 
  
  # W <- 1
  # fig2 <- ggplot() +
  #   geom_line(data=dat, aes(x=w, 
  #       y=((0.15*p$f0 + p$fc*p$epsA)*p$h*w^p$n + psi*(1-p$epsEgg)*A*W^(p$n-1)*w) / w^p$n)) +
  #   geom_line(data=dat, aes(x=w, A*W^(p$n-1)*w / w^p$n), size=0.5)
  # fig2 <- semilogx(fig2)
  # fig2
  
  ggsave("TeX/ChapterIndividual/budget.pdf",width=singlewidth, height=height)
  fig
}

plotTestGrowth <- function(K, Linf)
{
  p <- baseparameters()
  A <- calcA(K,Linf)
  p$A <- A
  W <- weight(Linf)
  p$W <- W
  t <- seq(0,30,length.out = 100)
  cat(A,'\n')
  
  out <- ode(y=p$w0, times=t, func=function(t,w,p) list(growth(p,w)), parms=p)
  
  fig <- ggplot() +
    geom_line(aes(x=t, y=weight(Linf*(1-exp(-K*t))))) +
    geom_line(aes(x=t, y=(0.25*p$A*t + p$w0^0.25)^4)) +
    geom_hline(yintercept = p$etaM*W) +
    geom_line(aes(x=out[,1], y=out[,2])) +
    ylim(c(0, W))
  fig
}


plotAllChapterIndividual <- function()
{
  pdfplot("TeX/ChapterIndividual/vonB2.pdf", plotSketch_and_vonB, width=doublewidth, height=height)
  plotKvsLinf()
  plotA()
  pdfplot("TeX/ChapterIndividual/maturity.pdf", plotMaturity, width=doublewidth, height=height)
  plotR()
  plotGrowth()
  plotBudget()
  
}
```


# 目的
- 個体の成長と再生産を表現する
  - Size spectrum theoryを個体群まで発展させるには個体について詳細に記述する必要
  - エネルギー収支（Energy budget)をサイズ(w)の関数とし、摂餌率から成長・再生産率を表現
  - これにより**個体が獲得したエネルギーをどう利用するか**を記述する
- 極限サイズをMaster traitとして確立する
  - von Bertalanffyの成長モデル（vBモデル）をベースに成長モデルを構築する
  - シンプルな理論の構築にはパラメータは少ないほうが良い
  - Life history invariants（魚種間で変動しないパラメータ）を使い、not invariantな（魚種間で変動する）パラメータを絞る
  - 最終的にパラメータは極限サイズに絞られる
  - これは魚類の生活史パターンの殆どを特徴づけることができるMaster traitとなる 
- 個体サイズ、極限サイズ、生活史パラメータに関係づけてエネルギー収支を記述
  - 成長と再生産だけでなく消化と代謝による損失も考慮
  - 生活史パラメータの多くは既往の知見から得られる経験的な値に頼った

# 3.1 The von Bertallanffy growth model
- vBモデルは成熟のコストを明確に取り入れていないが、後の章では考慮が必要に
- 本章では成熟前・後の異なる成長様式を1つのモデル(Biphasic growth model、以下BPモデル)で記述する

  - 成熟前：エネルギーをすべて成長に使う
  - 成熟後：エネルギーを成長と再生産に使う

- 最初に基本のvBモデルを詳しく見る

# vBモデル:1
<div align = "left">
- 同化作用(anabolic)と異化作用(catabolic)のプロセスから構成される

$$
\frac{dw}{dt}= Aw^n-kw\tag{3.4}
$$

  - $Aw^n$ :エネルギーの獲得(accuisition, anabolic) 
  - $kw$  :エネルギーの損失(losses, catabolic)　

- いずれも体重のべき乗（指数nと１）に比例する

- 指数nについて
  - エネルギーの獲得は同化作用の過程によって決まる
  - 同化作用は胃や腸など組織の表面積からの酸素や食料の吸収と解釈
  - シンプルな2/3乗則に従うと考えた


# vBモデル:２
<div align = "left">
(3.4)式は、$w=cl^3$の関係を使って$K= k/3$, $L_\infty=c^{-1/3}Ak$とおくと3.5式のように変形できる（see BOX3.1)

$$
\frac{dl}{dt} = K(L_\infty-l)\tag{3.5}
$$

両辺を積分して解く

$$
l(t) = L_\infty(1-e^{-K_t})\tag{3.6}
$$

- $L_\infty$：asymptotic length: 極限体長 
- $K$：growth constant（時間あたり）

$K$と$A$、$L_\infty$は $n = 2/3$のとき以下の関係が成り立つ

$$
K=\frac{A}{3c^{1/3}}\frac{1}{L_\infty}\tag{3.7}
$$

# 図3.1a
成長のごく初期は傾き$KL_\infty$の直線に近く（斜めの破線）

徐々に傾きが小さくなり$l$は$L_\infty$に近づく（横の破線）

```{r 3.1a, fig.width =8}
plotSketch_and_vonB()
```


# vBモデルの問題
- $K$と$L_\infty$に相関関係がある（図3.2）
  - $L_\infty$の誤差は$K$に影響（いっぽうが過大推定→もう一方は過小推定）
  - $L_\infty$の不確実性は高い
- Aを確かな筋から推定できれば、$L_\infty$の不確実性の$K$への影響を弱められる

- nは3/4のほうがいい
  - West(1997)は、代謝を表す体重のべき数に3/4乗則を採用した
  - 本章でもn=3/4を採用する 

# 図3.2　Kと$L_\infty$　の関係
- 既往の知見から得られた$K$ と$L_\infty$の関係
- $K = CL_\infty^{-n}$として、破線はnとCを推定した場合、実線はn＝0.75に固定した場合。水温15℃での成長になるよう調整
```{r g3.2, fig.height = 3, fig.width = 5}
plotKvsLinf()
```



# 3.2 Asymptotic size as a mster trait
<div align ="left">

- vBモデルはエネルギーの獲得（$AW^n$)と損失（$kw$）の関係が年齢・サイズによって変化することで形が決まる
- 年齢・サイズが大きくなると、繁殖による損失が大きくなり、成長にエネルギーが回らなくなる（図3.1b）

- $A$、$k$、$W_\infty$の関係は3.11式のように書ける

$$
W_\infty=\bigl(\frac{A}{k}\bigr)^\frac{1}{1-n}\tag{3.11}
$$

- (3.4)式と(3.11)式から(3.12)式が導ける。

$$
\frac{dw}{dt}=Aw^n\bigl[1-\bigl(\frac{w}{W_\infty}\bigr)^{1-n}\bigr]\tag{3.12}
$$

魚種による成長の違いは$A$と$W_\infty$だけで記述可能となった

# 図3.1b
- 個体の体重と獲得エネルギーの関係。太い実線が$Aw^n$、細い実線が$kw$。
- 右側の縦の破線は極限サイズ＝10kgの魚種の場合で、獲得エネルギーと損失エネルギーが等しくなったところで成長が止まる

```{r g3.1b, fig.height=3, fig.width = 7}
plotSketch_and_vonB()
```


# $A$について（経験値からの見積もり）
<div align ="left">
- $A$（Growth coefficient） はエネルギーの獲得と同化のプロセスを表現する
- このプロセスは種の極限体長とは関係しないと期待できる
- 既往の知見で得られたvBモデルの$K$と$L_\infty$の値を用い、3.10式に基づいて$A$を決定する（図3.3, BOX3.2）

- $A$ は$W_\infty$に対して変動幅が大きく、わずかに増加傾向
- 単純のため$A$はinvariant（$≒5.35g^{0.25}/yr$）とする

Box3.2の3.10式
$$
A=3c^{1/4}\eta_m^{-1/12}KL_\infty^{3/4}\tag{3.10}
$$


# 図 3.3
既往の知見で得られた$W_\infty$と$A$の関係。実線は$A$の相乗平均、破線は指数関数を当てはめた場合

```{r g3.3}
plotA()
```

# Biphasic growth equation
<div align ="left">
- vBモデルから発展

- 再生産にかかるコストを考慮するため、獲得エネルギーを全て成長に使う稚魚期と、繁殖にも使う成魚期の成長を区別した上で統合

- 初回成熟時の体重（$w_m$）の$W_\infty$に対する比率を$\eta_m$とすると

  - 稚魚期（$w<\eta_mW_\infty$のとき）: $g_j(w) = Aw^n$

  - 成魚期（$w>\eta_mW_\infty$のとき）: $g(w) = Aw^n-kw$

$\eta_m$は図3.4aからinvariant と仮定

# 図3.4
- 左（a）: $W_\infty$と$\eta_m$の関係（Olsson and Gislason 2016）。$\eta_m$は0.28と見積もった
- 右（b）: North sea saithe（タラの一種：ICES資源評価から）の成熟曲線。3.15式を使いu＝5と見積もった

```{r g3.4, fig.height=3, fig.width =7}
plotMaturity()
```

# 成熟関数の導入
<div align = "left">
- 両ステージをつなぐため関数$\psi_m(w/w_m)$を導入


$$
\psi_m(w/w_m) = \bigl[1+\bigl(\frac{w}{w_m}\bigr)^{-u}\bigr]^{-1}=\bigl[1+\bigl(\frac{w}{\eta_mW_\infty}\bigr)^{-u}\bigr]^{-1}\tag{3.15}
$$

- $\psi(w/w_m)$は、$w\ll w_m$ではゼロに、$w\gg w_m$では1に近づく
- uは立ち上がり強さ（steepness）を決めるパラメータ（図3.4b）
- 成熟関数を導入することにより、両ステージを一つの式で記述

$$
g_{bp}(w)=Aw^n-\psi_m(w/w_m)kw\tag{3.16}
$$

- ここで3.17式（$k=AW_\infty^{n-1}$）を使うと

$$
g_{bp}(w) = Aw^n\bigl[1-\psi\bigl(\frac{w}{\eta_mW_\infty}\bigr)\bigl(\frac{w}{W_\infty}\bigr)^{1-n}\bigr]\tag{3.18}
$$

BPモデルはsize-at-ageを解析的に解けないが幼魚期の部分だけは解ける（Box3.3）

# 図3.6

- 数値計算で解いたBPモデルとvBモデルの比較

```{r g3.6}
plotGrowth()
```

- 薄いグレーの線は、既往の知見で得られたvB成長曲線のうち、$W_\infty$が1.6kg以上2.4kg未満のもの
- 濃いグレーは$W_\infty$を同じ範囲とし、図3.3から得られるAの範囲を与えたとき、BPモデルで得られる成長曲線。太い実線はその中央値

# 繁殖への投資

- BPモデルは繁殖への投資(investment in reproduction)を考慮した

- 繁殖への投資の指数はマイナス（3.17式、 $k=AW_\infty^{n-1}$）であり、これは$W_\infty$が大きくなると体重あたりの繁殖投資が減少することを意味する（観測値に一致する、図3.5）

- 繁殖投資（$kw$）は卵生産だけでなく他の繁殖に関わる投資（産卵回遊など）も含むが、それも産卵量（$R_{egg}$:個体あたり時間あたり卵量）に比例すると考える

$$
R_{egg} = \varepsilon_{egg}kw = \varepsilon_{egg}AW^{n-1}_\infty\tag{3.19}
$$

$\varepsilon_{egg}$ (再生産効率:reproductive efficiency)はinvariantで、図3.5から0.22と見積もった

# 図3.5
- $W_\infty$とReproductive outputの関係。この関係から$\varepsilon_{egg}$ ≒0.22と見積もった。
- GSI/Aをreproductive output としている。データはGunderson(1997)


```{r g3.5}
plotR()
```


# BPモデルのまとめ

- パラメータ（$A$,　$\varepsilon_{egg}$, $\eta_m$, $n$）はinvariantとする

- 魚種による違いを表現するmaster traitとして極限サイズ$W_\infty$ を採用

- これにより小型魚から大型魚まで含めたgeneral statementを作ることができる

- $W_\infty$以外の形質について種特異的な値を用いれば、種特異的な、より正確な成長式が得られる


$$
g_{bp}(w) = Aw^n\bigl[1-\psi\bigl(\frac{w}{\eta_mW_\infty}\bigr)\bigl(\frac{w}{W_\infty}\bigr)^{1-n}\bigr]\tag{3.18}
$$

# 3.3 Bioenergetic formulaton of the growth equation
<div align = "left">
- Biphasic growth modelは２章で構築した生理学に基づく過程とどう結びつくか？

- vBモデルのエネルギー収支の考えは単純すぎる
- $kw$で表現している損失は主に再生産だが他にも損失がある

エネルギー代謝を数式で表現すると

$$
C(w)=M_{assim}(w) + M_{std}(w) +M_{act}(w) + R_{egg}(w)/\varepsilon_{egg}+g(w)\tag{3.26}
$$

- $C$ :consumption,　　$M_{assim}$:assimilation

- $M_{std}$: standard metabolism,　　$M_{act}$ :activity

- $R_{egg}/\varepsilon_{egg}$:reproduction,　　$g$:growth


# Consumption and assimilation

- 2章において摂餌率を　$C(w) = f_0hw^n$ (2.18式)と記述した

- 摂餌と同化のあいだにエネルギーに使用されない損失がある

  - 排泄（egestion:消化器系の排泄 + excreation:血液系の排泄）
  - 消化吸収のための代謝（$M_{assim}$)による損失

- これらは摂餌率に比例する

Kitchell el al.(1977)は消化吸収で15％、egestionで15％、excreationで10％、合計40%のロスがあると見積もった。ここから$\varepsilon_a$＝1－0.4＝0.6とすると、同化率は

$$
C_{assim}(w) = \varepsilon_af_0hw^n\tag{3.27}
$$

# Standard metabolism and activity

- 基礎代謝は $M_{std} = k_sw^n$ と書ける

- activityによる代謝$M_{act}$は見積もりが難しいので、$M_{std}$に比例するとして$M_{std}$と合わせて考える

- $M_{std}+M_{act}$は最大摂餌率$hw^n$に比例すると考え、$k_s = f_c\varepsilon_ah$（$f_c$は限界摂餌レベル）として

  

$$
M_{std}(w) + M_{act} = f_c\varepsilon_ahw^n\tag{3.28}
$$



$f_c$ はinvariantsであり、Hartvig et al.(2011)により約0.2と見積もる



# ふたたび$A$について（理論的な見積もり）
<div align = "left">

3.26 式を書き換えて成長を表すようにまとめると、

$$
g(w) = \varepsilon_af_0hw^n -f_c\varepsilon_ahw^n-\psi(w/w_m)kw\tag{3.29}
$$

$$
g(w) = \varepsilon_ah(f_0-f_c)w^n-\psi(w/w_m)kw\tag{3.30}
$$


となり、$A$は以下のように書ける

$$
A=\varepsilon_ah(f_0-f_c)\tag{3.31}
$$


$\varepsilon_a, f_0, fc, h$ はinvariantsであるから、$A$は理論的にinvariantと考えることができる。 


# 図3.8
```{r g3.8, fig.height = 5}
plotBudget()
```

# 3.4 Which other traits describe fish life histories?

- 3.11式は$W_\infty$ 、 $A$、$k$ の関係を示している。$W_\infty$ではなく$k$をMaster trait とすることもできるが、$W_\infty$には利点がある
- 使いやすく推定が楽。
  - data-limitedな資源でも推定可能
  - 直感的にわかりやすい
  
- $W_{\infty}$と$A$  からの他のパラメータを決められる？

  - 理論的には正しいが、データからは明確に示せていない
  - invariant として扱ったパラメータはinvariantか？ 例えば$W_\infty$ と$W_m$ (成熟サイズ) の比（$\eta_m$)は種によってかなり異なるが


# 検討
- "Invariant”とは”種によらず一定"ということではない
  - 他の形質（成長速度、水温などの環境、系統発生学的な位置関係）と”co-vary”ではないということ
  - invariantとされる形質の魚種による変動はランダムで、予測不能である

- データの限界
  - 直接推定されてないパラメータもあり、考慮できていないバイアスがある可能性
  - 既往のvBモデルは1個体の成長ではなく平均的なもので、現実の個体の成長を表していない
  - 繁殖への投資などは推定自体難しい
  
- 魚種間の変動に関わる、考慮できていない形質がある
  - 候補の形質はslow-fast life history continuum と防御
  - 考慮すべき形質が増えるとモデルは複雑になる
  - 意味のある改善がみとめられない限り、考慮すべき形質は少ないほうが良い

- 最小モデルのMaster traitを極限サイズとするのは妥当

# 3.5 Summary

- BPモデルは成長と再生産が、極限サイズが異なる魚種間でどのように変化するかを示す。成長に関する様々なことをinvariantなパラメータのセットと極限サイズで説明できる。

- パラメータは魚種間で一定ではないが、極限サイズとの関係においてsystematicな変動はないので、それらはinvariantとして扱い、極限サイズを Master traitとすることは妥当

- 問題点
  - vBのモデルとは一致しない：稚魚期の予測値が小さくなる
  - 吸収と基礎代謝による損失においてn=3/4を用いたため。3/4より大きい可能性があり、改善の余地がある
  
- BPモデルは完璧ではない。精度を犠牲にしている。しかしシンプルな理論を構築するため、一つのMaster trait（$W_\infty$）による単純なモデルを作るという本章の目的をよく果たすものである。


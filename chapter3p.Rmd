---
title: "Chapter 3"
subtitle: Individual Groth and Reproduction
author: 担当 渡邊
date: 2020/6/8
output:
  revealjs::revealjs_presentation:
    theme: white
    self_contained: false
    transition: none 
    highlight: pygments
    #default fade slide convex concave zoom none
    reveal_options:
      #autoSlide: 5000
      width: 960
      height: 720
      control: true
      progress: true
      slideNumber: true
      previewLinks: true
      history: false
      overview: true
      center: false
      left: true
      mouseWheel: false
    fig_width: 6
    fig_height: 4
    fig_caption: false
    #css: "for-revealjs.css"
    #mathjax: local
    #reveal_plugins: ["notes"] #search
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, cache = F, eval = T)
knitr::opts_knit$set(root.dir = normalizePath("C:/RWD/FEEread"))
```


```{r code, include = FALSE}
library(fishsizespectrum)
source("R/basetools.R")

#dir.create("TeX/ChapterIndividual")

getGrowthParameters <- function()
{
  data <- read.csv("Data/fecundpruned.csv",header=TRUE,sep=",")
  data$Winf <- data$aW * data$Linf^data$bW
  data$Wm  <- data$aW * data$Lm^data$bW
  data$Phylum <- data$phyl
  levels(data$Phylum) <- c("Elasmobranchs", "Teleosts")
  #
  # Data from Kooijman and Gislason:
  #
  data2 = read.csv("Data/KooijmanGislason.csv", header=FALSE, col.names=c("K","Linf","T"))
  #
  # Combine data for fish
  # 
  Q10 <- 1.83
  ix  <- data$Phylum == "Teleosts"
  dat <- data.frame(K=data$K[ix] * Q10^((15-data$T[ix])/10), 
                    W=data$Winf[ix])
  dat2 <- data.frame(K=data2$K * Q10^((15-data2$T)/10), W=0.01*data2$Linf^3)
  dat = rbind(dat, dat2)
  
  p <- baseparameters()
  dat$L <- (dat$W/p$c)^(1/3)
  
  dat$A = calcA(dat$K, dat$L)
  
  dat
}

panelvonB <- function()
{
  #
  # Sketch of von B curve
  # 
  Linf <- 100
  K <- 0.18
  
  ages = seq(0,30,length.out=100)
  
  defaultpanel(xlim=ages, ylim=c(0,c(0,110)),
               xlab="Age (years)",
               ylab="Length (cm)",
               label=TRUE)
  lines(ages, Linf*(1-exp(-K*ages)), lwd=3)
  lines(ages, y=K*Linf*ages, lty="dashed", lwd=1)
  lines(x=ages, y=Linf*ages/ages, lty="dashed", lwd=1)
}

panelSketch <- function()
{
  #
  # Sketch of Winf
  # 
  xlim = c(1e-11,1e5)
  ylim = c(5e-10,1e6)
  p <- baseparameters()
  
  n <- p$n
  W1 = 10
  W2 = 10000
  A <- p$A
  k = function(W) A*W^(n-1)
  
  w=10^seq(from=-3, to=6, length.out=100)
  Ea = A

  loglogpanel(xlim=w, ylim=A*w^n, 
              xlab="Body weight (g)", 
              ylab="Available energy, $E_a$ (g/yr)",
              label=TRUE)
  lines(w, A*w^n, lwd=3)
  
  ix = w<10*W1
  lines(w[ix], k(W1)*w[ix])
  lines(W1*c(1,1), c(1e-4,6*W1^n), lty=dashed)

  ix = w<10*W2
  lines(w[ix], k(W2)*w[ix])
  lines(W2*c(1,1), c(1e-4,6*W2^n), lty=dashed)
}


plotSketch_and_vonB <- function()
{
  defaultplot(mfcol=c(1,2))
  panelvonB()
  panelSketch()
}


plotKvsLinf <- function()
{
  dat <- getGrowthParameters()
  
  fig <- ggplot() +
    geom_point(data=dat, aes(x=L, y=K), colour=grey(0.3))
  # fit
  fit <- lm(log(K) ~ log(L), data=dat)
  tmp <- data.frame(x=dat$L, y=exp(predict(fit)))
  cat('Fit of K: C = ', exp(fit$coefficients[1]), 
      ' and exponent ', fit$coefficients[2], "\n")
  
  # fit with exponent -0.75:
  C <- exp(mean(log(dat$K * dat$L^0.75)))
  cat('K fitted wit n=0.75: ', C, "\n")
  
  # fit with exponent -1:
  C2 <- exp(mean(log(dat$K * dat$L)))
  
  fig <- fig +
    geom_line(data=tmp, aes(x=x,y=y),linetype="dashed") +
    geom_line(data=tmp, aes(x=x, y=C*x^-0.75)) #+
  #geom_line(data=tmp, aes(x=x, y=C2/x), linetype="dotted")
  
  fig <- fig +
    xlab(TeX("Asymptotic length, $\\textit{L}_{\\infty}$ (cm)")) + 
    ylab(TeX("von Bertalanffy coefficient, $\\textit{K}$ (1/yr)"))
  fig <- loglog(fig, ylim=c(0.03, 3))
  
  ggsave("TeX/ChapterIndividual/KvsLinf.pdf",width=singlewidth,height=singlewidth)
  fig
}

plotA <- function() 
{
  dat <- getGrowthParameters()
  
  fig <- ggplot() +
    geom_point(data=dat, aes(x=W, y=A), colour=grey(0.3))
  
  # fit
  fit <- lm(log(A) ~ log(W), data=dat)
  tmp <- data.frame(x=dat$W, y=exp(predict(fit)))
  fig <- fig + geom_line(data=tmp, aes(x=x,y=y),linetype="dashed")
  cat("Fit to A, coef.: ", exp(fit$coefficients[1]), ", exponent: ", fit$coefficients[2],'\n')
  
  # Mean value:
  Amean <- exp(mean(log(dat$A)))
  cat("Amean ",Amean,"\n")
  fig <- fig + 
    geom_line(data=data.frame(x=c(min(dat$W), max(dat$W))), 
              aes(x=x, y=Amean)) #+
  #
  # Finalize figure
  #
  fig <- fig +
    theme(legend.position=c(1,0), legend.justification=c(1,0)) +
    scale_colour_grey()+ 
    xlab(TeX("Asymptotic weight, $\\textit{W}_{\\infty}$ (g)")) + 
    ylab(TeX("Growth coef. $\\textit{A}$ ($g^{1/4}$/yr)")) +
    labs(colour="",shape="")
  fig <- loglog(fig)  
  
  ggsave("TeX/ChapterIndividual/A.pdf", width=singlewidth, height=height)
  fig
}


panelEtam <- function()
{
  p <- baseparameters()
  # 
  # etam
  # 
  data <- read.csv("Data/fecundpruned.csv",header=TRUE,sep=",")
  data$Winf <- data$aW * data$Linf^data$bW
  data$Wm  <- data$aW * data$Lm^data$bW
  data$etam <- data$Wm/data$Winf
  data$Phylum <- ifelse(data$phyl=="t","Teleosts","Elasmobranchs")
  levels(data$Phylum) <- c("Elasmobranchs", "Teleosts")
  
  loglogpanel(xlim=data$Winf, ylim=c(0.01,2),
              xlab="Asymptotic weight $\\textit{W}_{\\infty}$ (g)", 
              ylab="Rel. maturation size, $\\textit{\\eta}_\\textit{m}$",
              label=TRUE)
  ixElasmo = data$Phylum=="Elasmobranchs"
  ixTele = data$Phylum=="Teleosts"
  points(data$Winf[ixElasmo], data$etam[ixElasmo], pch=dots, col=stdgrey)
  points(data$Winf[ixTele], data$etam[ixTele], pch=dots)
  #
  # Fits
  # 
  
  # all:
  fit <- lm(log(etam) ~ log(Winf), data=data)
  #tmp <- data.frame(x=data$Winf, y=exp(predict(fit)))
  #fig <- fig + geom_line(data=tmp, aes(x=x,y=y),linetype="dashed")
  lines(range(data$Winf), exp(fit$coefficients[1])*range(data$Winf)^fit$coefficients[2],
        lty=dashed, lwd=3)  
  # teleosts:
  ix <- data$Phylum=="Teleosts"
  fitfish <- lm(log(Wm[ix]/Winf[ix]) ~ log(Winf[ix]), data=data)
  tmp <- data.frame(x=data$Winf[ix], y=exp(predict(fitfish)))
  #fig <- fig + geom_line(data=tmp, aes(x=x,y=y), linetype="dotted")
  # teleosts with exponent 1:
  etam <- exp(mean(log(data$Wm/data$Winf)))
  cat('Average eta_m',etam,'\n')
  lines(range(data$Winf), etam*c(1,1), lwd=3)
  
  legend("bottomright", bty="n", 
         legend=c("Teleosts", "Elasmobranchs"),
         pch=c(dots,dots),
         col=c("black", stdgrey))
}

panelOgive <- function() {
  ogive <- as.matrix(read.table(file="Data/maturity_saithe.dat", header=FALSE, skip=5))
  weights <- as.matrix(read.table(file="Data/weightatage_saithe.dat", header=FALSE, skip=5))
  
  weights[weights==0] <- max(weights)
  nages <- dim(weights)[1]
  nyears <- dim(weights)[2]
  dat <- data.frame(weight=log(as.vector(weights)), ogive=as.vector(ogive), 
                    year=rep(seq(1,nyears),nages))
  dat$ogive[ogive==0] <- NaN
  dat$ogive[ogive==1] <- NaN
  dat$ogive.logit <- qlogis(dat$ogive)
  
  dat$year = factor(dat$year)
  
  m = glm( ogive.logit ~ 0 + year + weight, data=dat )
  
  semilogxpanel(xlim=c(0.1,10), ylim=c(0.01,1),
                xlab="\\textit{w}/\\textit{w}_{maturation}", 
                ylab="Maturity",
                label=TRUE)
  
  for(i in 1:nyears) {
    ix = dat$year==i
    points(exp(dat$weight[ix]+coef(m)[i]/coef(m)[nyears+1]), dat$ogive[ix], pch=dots, col=stdgrey)
  }
  w = 10^seq(-2,1, length.out = 100)
  lines( w, psi(w, coef(m)[nyears+1]) , lwd=3)  
  vline(1)
  
  print(coef(m)[nyears+1])
}

plotMaturity <- function() {
  defaultplot(mfcol=c(1,2))
  panelEtam()
  panelOgive()
  
}

plotR <- function()
{
  #
  # Use gunderson data
  #
  p <- baseparameters()
  A <- read.csv("Data/Gunderson.csv", header = TRUE, sep = ",")
  A$Winf <- weight(A$Linf)
  
  # Estimate A from age at maturation + 0.5:
  A$A <- p$etaM^0.25/((1-p$n)*(A$alpha+0.5))*A$Winf^(1-p$n) #log(1-p$etaM^0.25*p$etaA) / (-0.25*p$etaA*(A$alpha+0.5) ) * A$Winf^(1-p$n)
  
  fig <- ggplot(data=A) +
    geom_point(aes(x=Winf, y=GSI/A), colour=grey(0.3))
  
  # all:
  fit <- lm(log(GSI/A) ~ log(Winf), data=A)
  tmp <- data.frame(x=A$Winf, y=exp(predict(fit)))
  fig <- fig + geom_line(data=tmp, aes(x=x,y=y),linetype="dashed")
  cat('Fit to R', fit$coefficients,'\n')
  
  epsA <- exp(mean(log(A$GSI/A$A*A$Winf^0.25)))
  cat('eps_repro = ', epsA, '.\n')
  
  fig <- fig + 
    geom_line(aes(x=Winf, y=Winf^(p$n-1))) +
    geom_line(aes(x=Winf, y=Winf^(p$n-1)*epsA)) +
    xlab(TeX("Asymptotic weight, $\\textit{W}_{\\infty}$ (g)")) + 
    ylab(TeX("Repro. output  ($g^{-0.25}$)"))
  
  fig <- loglog(fig)
  ggsave("TeX/ChapterIndividual/R.pdf", width=singlewidth, height=height)
  fig
}  


plotGrowth <- function()
{
  #
  # Plot some growth functions
  #
  library(deSolve)
  width = 10
  height = 6
  
  W = 2000
  fig <- ggplot()
  p <- baseparameters()  
  p$W <- W
  # Add my growth curve:
  #n <- p$n
  #epsA <- p$etaA
  etaM <- p$etaM
  A <- p$A
  
  # Interval:
  CV = 1.95 # Estimated as exp(sqrt(var(log(dat$A)))) in plotA.R
  ages = seq(0,50,length.out=500)
  p1 <- p
  p1$W <- p$W*0.8
  p1$A <- p$A/CV
  p2 <- p
  p2$W <- p$W/0.8
  p2$A <- p2$A*CV
  out1 <- ode(y=p$w0, times=ages, func=function(t,w,p) list(growth(p,w)), parms=p1)
  out2 <- ode(y=p$w0, times=ages, func=function(t,w,p) list(growth(p,w)), parms=p2)
  
  fig <- fig + 
    geom_ribbon(aes(x=out1[,1], ymin=out1[,2], ymax=out2[,2]),
                fill=grey(0.5))
  
  # Add observed von Bertalanffy curves:
  dat <- getGrowthParameters()
  
  ix <- dat$W>0.8*W & dat$W<(1/0.8)*W
  
  ages <- seq(0,50, length.out = 150)
  for (i in 1:sum(ix)) {
    w <- weight( (dat[ix,]$L[i]*(1-exp(-dat[ix,]$K[i]*ages))) )
    fig <- fig + 
      geom_line(data=data.frame(x=ages,y=w),
                aes(x=x,y=y), size=thin, colour=grey(0.75))
  }
  # "Median" line
  out <- ode(y=p$w0, times=ages, func=function(ages,w,p) list(growth(p,w)), parms=p)
  fig <- fig + 
    geom_line(aes(x=out[,1],y=out[,2]), size=1) +
    geom_hline(yintercept=etaM*W, linetype="dotted",size=thin) +
    geom_vline(xintercept = ageMaturation(W=W), linetype="dotted",size=thin)
  
  fig <- fig +
    xlab("Age (yr)") + 
    ylab("Weight (g)") +
    scale_x_continuous(limits=c(0,0.5*A*W^0.25), oob=rescale_none) +
    scale_y_continuous(oob=rescale_none)
  fig <- mytheme(fig)
  
  ggsave("TeX/ChapterIndividual/Growth.pdf",width=width, height=height, units="cm")
  fig
}


plotBudget <- function()
{
  p <- baseparameters()
  W <- 1
  eta <- 0.001
  A <- p$A
  h <- p$h
  n <- p$n
  epsEgg <- p$epsEgg
  etaM <- p$etaM
  
  k  = A*W^(n-1)
  maxrate = A*W^n
  dat = data.frame(w = 10^seq(from=log10(eta*W), to=log10(W), length.out=100))
  dat$psi = (1 + (dat$w/(etaM*W))^(-10))^(-1)
  
  fig <- ggplot() +
    # consumption:
    geom_line(data=dat, aes(x=w, y=p$f0*h*w^n/maxrate), size=thick) +
    # consumption minus egestion and excretion:
    geom_ribbon(data=dat, aes(x=w, ymax=(1-0.15-0.1)*p$f0*h*w^n/maxrate, 
                              ymin=0.01/maxrate), fill=grey(0.9)) +
    # available energy
    geom_ribbon(data=dat, aes(x=w, ymax=A*w^n/maxrate, ymin=0.01/maxrate), 
                fill=grey(0.8)) +
    geom_line(data=dat, aes(x=w, y=A*w^n/maxrate)) +
    #geom_ribbon(data=dat, aes(x=w, ymax=(A*w^n-epsR*k*w)/maxrate, 
    #                          ymin=0.01/maxrate), fill=grey(0.6)) +
    # Reproductive out:
    geom_ribbon(data=dat, 
                aes(x=w, ymax=(A*w^n-(1-epsEgg)*psi*k*w)/maxrate, ymin=0.01/maxrate), 
                fill=grey(0.6)) +
    # Reproductive output:
    #geom_ribbon(data=dat, 
    #            aes(x=w, ymax=(A*w^n-epsR*psi*k*w)/maxrate, ymin=0.01/maxrate), 
    #            fill=grey(0.4)) +
    # Growth
    #geom_line(data=dat, aes(x=w, y=(A*w^n-psi*k*w)/maxrate), linetype="dashed") +
    geom_ribbon(data=dat, 
                aes(x=w, ymax=(A*w^n-psi*k*w)/maxrate, ymin=0.01/maxrate), 
                fill=grey(0.2)) +
    #geom_line(data=dat, aes(x=w, y=(A*w^n-(1-epsEgg)*psi*k*w)/maxrate), 
    #          linetype="dashed", size=thick) +
    geom_vline(xintercept = etaM, linetype="dotted", size=thin) +
    xlab(TeX("Relative body weight $(\\textit{w}/\\textit{W}_{\\infty})$")) + 
    ylab("Normalized rates")
  fig <- loglog(fig, xlim=c(0.01,1), ylim=c(2e-2,3)) 
  
  # W <- 1
  # fig2 <- ggplot() +
  #   geom_line(data=dat, aes(x=w, 
  #       y=((0.15*p$f0 + p$fc*p$epsA)*p$h*w^p$n + psi*(1-p$epsEgg)*A*W^(p$n-1)*w) / w^p$n)) +
  #   geom_line(data=dat, aes(x=w, A*W^(p$n-1)*w / w^p$n), size=0.5)
  # fig2 <- semilogx(fig2)
  # fig2
  
  ggsave("TeX/ChapterIndividual/budget.pdf",width=singlewidth, height=height)
  fig
}

plotTestGrowth <- function(K, Linf)
{
  p <- baseparameters()
  A <- calcA(K,Linf)
  p$A <- A
  W <- weight(Linf)
  p$W <- W
  t <- seq(0,30,length.out = 100)
  cat(A,'\n')
  
  out <- ode(y=p$w0, times=t, func=function(t,w,p) list(growth(p,w)), parms=p)
  
  fig <- ggplot() +
    geom_line(aes(x=t, y=weight(Linf*(1-exp(-K*t))))) +
    geom_line(aes(x=t, y=(0.25*p$A*t + p$w0^0.25)^4)) +
    geom_hline(yintercept = p$etaM*W) +
    geom_line(aes(x=out[,1], y=out[,2])) +
    ylim(c(0, W))
  fig
}


plotAllChapterIndividual <- function()
{
  pdfplot("TeX/ChapterIndividual/vonB2.pdf", plotSketch_and_vonB, width=doublewidth, height=height)
  plotKvsLinf()
  plotA()
  pdfplot("TeX/ChapterIndividual/maturity.pdf", plotMaturity, width=doublewidth, height=height)
  plotR()
  plotGrowth()
  plotBudget()
  
}
```



# 背景
(para1)
Size spectrum theoryをpopulationまで発展させるために個体についての詳細な記述が必要。
エネルギー収支をサイズの関数として表現し、吸収率(consumption rate)から成長・再生産率を決める。
これにより個体が獲得したエネルギーをどのように利用するか記述する。
(para2)
成長率をエネルギー収支から決めようという取り組みは20世紀初頭から試みられてきた。
von Bertalanffy(1957)：Quantitative Laws in Growth and Metabolismにおいて強力なツールであるvon Bertalanffy の成長式が開発され、これが本章で用いるBiphasic Growth modelの基礎となる（Ursin, 1979などなど）
エネルギー収支は集団の中の個体を記述するパラメータに依存する。
最もシンプルな成長モデル（vBモデルのような）は、2つのパラメータで構成されるが、より複雑なモデルはより多くのパラメータを必要とする。
魚類は実に多様な生活史パターンを示すので、複雑なモデルのほうがよくそれらを表現する。
しかしシンプルな理論を構築するという見地からは、パラメータが多いとシンプルな関係を明らかにするのを困難にする。
そこで、いわゆるlife history invariantsを使ってパラメータを減らしていく。
life history invariants とは、魚種間で”systematically”に変動しないパラメータのことである。
これはたいへんうまいやりかたで、not invariantな（つまり魚種間で変動する）パラメータをasymptotic sizeに絞ることができる。
このパラメータは魚類の生活史の変異の殆どを特徴づけるMaster Traitの役割を果たす。 
(para3)
このエネルギー収支は個体のなかの質量とエネルギーの流れのすべてを考慮する。成長と再生産に使われるエネルギーと同様、
消化と代謝による損失も扱う。
エネルギー収支は、個体による、個体の状態（飢餓、サイズ、成熟）とその生活史戦略に従う決定によって構築される。
これらの決定は、個体の適応度を最適化するための生活史最適化の枠組みと理解できるだろう。
そのような理論の断片的に検討されてきた。
例えば再生産スケジュールなど。しかし完成されたものは明らかにされていない。
したがって、大部分経験的にもとめられた生活史パラメーターに頼ることになる。
この章の目的は以下のとおりである。

1. 個体の成長と再生産を表現する
2. 極限サイズをmaster traitとして確立する
3. 個体サイズ、極限サイズおよび生活史パラメータに関係づけてエネルギー収支のパラメータを決定する

# 3.1 The von Bertallanffy growth model

本章では、成熟前と成熟後の異なる成長様式を一つのモデルで記述する(biphasic growth model)
- 成熟前：エネルギーをすべて成長に使う
- 成熟後：エネルギーを成長と再生産に使う

再生産にかかるコストを考慮した成長モデルがのちの章で必要になる。 
最初に、もとになるvon Bertalanffyの成長式を詳しく見ていく</span>


# vB modelの基本

<div align="left">
- 同化作用(anabolic)と異化作用(catabolic)のプロセスから構成される
  - $Aw^n$ :エネルギーの獲得(accuisition, anabolic) 
  - $kw$  :エネルギーの損失(losses, catabolic)　



$$
\frac{dw}{dt}= Aw^n-kw\tag{3.4}
$$

- いずれも体重のべき乗（ｎと１）に比例する。
- nについて
  - エネルギーの獲得は同化作用の過程によって決まる
  - 同化作用は胃や腸など組織の表面積からの、酸素や食料の吸収と解釈
  - シンプルな2/3乗則に従うと考えた（２章で議論済）




# 体長ベースの成長式：vBモデル
<div align="left">
(3.4)式は$w=cl^3$の関係を使い、$K= k/3$, $L_\infty=c^{-1/3}Ak$とおくと以下のように変形できる（see BOX3.1)

$$
\frac{dl}{dt} = K(L_\infty-l)\tag{3.5}
$$


両辺を積分して解くと

$$
l(t) = L_\infty(1-e^{-K_t})\tag{3.6}
$$

- $L_\infty$：asymptotic length: 極限体長, 
- K：growth constant（時間あたり）

Kと$A$、$L_\infty$との関係は n = 2/3のとき

$$
K=\frac{A}{3c^{1/3}}\frac{1}{L_\infty}\tag{3.7}
$$


vBモデルは、年齢あたりのサイズの変化をよく表現し、かつ体長という測定しやすい変数を用いたことで大いに成功した。


## 図3.1a

初期の成長は傾き$KL_\infty$の直線似近く（斜めの破線）、$l$が$L_\infty$に近づくと成長が止まる（横の破線）。

```{r 3.1a, fig.height=4, fig.width =8}

plotSketch_and_vonB()
```

## Box3.1 Length and Weight-based vB model
<div align ="left">
3.4式を$w=cl^3$を用いて変形すると

$$
\frac{dw}{dt}=\frac{dcl^3}{dt}=3cl^2\frac{dl}{dt}=Aw^n-kw
$$




$$
\frac{dl}{dt} = \frac{1}{3cl^3}A(cl^3)^n-\frac{kcl^3}{3cl^3}
$$



ここでn=2/3 ならば
$$
\frac{dl}{dt}=\frac{1}{3}C^{-1/3}A-\frac{k}{3}l =\frac{k}{3}\bigl(\frac{c^{-1/3}A}{k}-l\bigr)
$$

K=\frac{k}{3}$,  $L_\infty = \frac{c^{-1/3}A}{k}$ とおけば、3.5式と同じになる。

# vBモデルの問題
<div align ="left">
- $K$と$L_\infty$に相関関係がある（図3.2）
	- $L_\infty$の誤差は$K$に影響（いっぽうが過大推定されると、もう一方は過小推定される）
	- $L_\infty$の不確実性は高い
	- Aを確かな筋から推定できれば、$L_\infty$の不確実性の$K$への影響は制限されるだろう

- nは3/4のほうがいい
	- est(1997)は、代謝を表す体重のべき数に3/4乗則を採用した
	- ここでも代謝生態学の流れに従い、n=3/4を採用する 

## 図3.2　Kと$L\infty$　の関係

```{r 3.2}
plotKvsLinf()
```



# 3.2 Master Traitとしての$W_\infty$
<div align ="left">

- vBモデルはエネルギーの獲得（$AW^n$)と損失($kw$)の関係が年齢・サイズによって変化することで形が決まる
- 年齢・サイズが大きくなる→損失が大きくなる→成長にエネルギーが回らなくなり成長は止まる
- $A$,$k$,$W_\infty$の関係は3.11式のように書ける


$$
W_\infty=\bigl(\frac{A}{k}\bigr)^\frac{1}{1-n}\tag{3.11}
$$


(3.4)、(3.11)式から(3.12)式が導ける。
種による成長の違いは$A$と$W_\infty$だけで記述できる
$$
\frac{dw}{dt}=Aw^n\bigl[1-\bigl(\frac{w}{W_\infty}\bigr)^{1-n}\bigr]\tag{3.12}
$$


## 図3.1a
初期の成長は傾き$KL_\infty$の直線似近く（斜めの破線）、$l$が$L_\infty$に近づくと成長が止まる（横の破線）。

```{r 3.1, fig.height=4, fig.width =6}
plotSketch_and_vonB()
```


# $A$について
<div align ="left">

- $A$(Growth coefficient) はエネルギーの獲得と同化のプロセスを表現する
- このプロセスは種の極限体長とは関係しないと期待できる。
- vBモデルで推定された$K$ と$L_\infty$の値を用い、（3.10）式に基づき$A$を決定する（図3.3, BOX3.2）

- 図3.3から、Aは$W_\infty$に対して独立のよう
- 変動は大きい
- $W_\infty$に対してやや増加傾向だが、以下では単純のためAは一定（$≒5.35g^{0.25}/yr$)として扱う。


## 図 3.3

```{r 3.3, fig.height=4, fig.width =6}
plotA()
```

## BOX3.2
$KL_\infty$とAの関係は、n=2/3で確認されているのであるが、box3.2から、n=3/4でも概ねOK。

# Biphasic Growth Equation
- vBモデルから発展
- エネルギーを成長につぎ込む稚魚期と、繁殖も行う成魚の成長を区別した上で統合、再生産によるロスを成長式に反映した

初回成熟時の体重（＝半数成熟体重）の極限体重に対する比率を$\eta_m$とすると
- 未成魚の成長　$g_j(w) = Aw^n$
- 成魚の成長　　$g(w) = Aw^n-kw$ ,    $w>\eta_mW_\infty$


両者を成熟関数$\psi_m(w/w_m)$でつなぐ

$$
\psi_m(w/w_m) = \bigl[1+\bigl(\frac{w}{w_m}\bigr)^{-u}\bigr]^{-1}=\bigl[1+\bigl(\frac{w}{\eta_mW_\infty}\bigr)^{-u}\bigr]^{-1}\tag{3.15}
$$

$\psi(w/w_m)$は、$w\ll w_m$ではゼロに、$w\gg w_m$では1に近づく。
uはその変化の強さを決めるパラメータ（図3.4bの立ち上がり＝steepnessを決める）


成熟関数を導入することにより、生活史の異なるphaseを一つの式にまとめる
$$
g_{bp}(w)=Aw^n-\psi_m(w/w_m)kw\tag{3.16}
$$
ここで3.11式を変形した3.17式を使うと、成長式は3.18式のように書ける
$$
k=AW_\infty^{n-1}\tag{3.17}
$$


$$
g_{bp}(w) = Aw^n\bigl[1-\psi\bigl(\frac{w}{\eta_mW_\infty}\bigr)\bigl(\frac{w}{W_\infty}\bigr)^{1-n}\bigr]\tag{3.18}
$$

biphasic modelは解析的に解けないが、幼魚期の部分だけとりだせば解析的に解くことができる（Box3.3）


# Biphasic model の利点
- 繁殖への投資を考慮している
- 再生産が極限体長に対してどのようにスケーリングされるか示している

繁殖への投資のべき数は負であるので、極限体長が大きくなるほど体重あたりの繁殖への投資は減少する。この減少のパターンは図3.5に示すように、観察されている。
繁殖投資kwは卵の生産だけでなく、他の繁殖に関わる要素：産卵回遊など　にも使われる。これらその他の繁殖に要するエネルギーも個体の産卵量（ $R_egg$ 個体あたり時間あたり卵量）に比例すると考えて、
$$
R_{egg} = \varepsilon_{egg}kw = \varepsilon_{egg}AW^{n-1}_\infty
$$

$\varepsilon_{egg}$ は再生産効率（reproductive efficiency)であり、図3.5から0.22に近似できる。

## 図3.5
```{r 3.5}
plotR()
```



# Trait based growth model が仮定するもの

パラメータ（$A$,　$\varepsilon_{egg}$, $\eta_m$, $n$）は, 種の間で大まかにはinvariantとし、成長と再生産の種の違いを表現する、主たる形質（master trait)として極限サイズ$W_\infty$ を採用した。

これにより、小さい魚と大きな魚の違いについて一般化した記述が可能になる（general statementを作ることができる）。

もちろん$W_\infty$以外の形質についても種特異的な値を用いれば、その種のより正確な成長式を得ることができる。



# 3.3 成長式とエネルギー収支

biphasic growth modelは、成長と再生産をサイズの関数として記述する。一つの朱だけを相手にするには十分だが、今後動的な成長に関する記述を扱うには不十分。それに重要なパラメータである成長効率Aは経験的なデータに頼って決めた。Aは２章で構築した生理学に基づく基本的な仮定とどう結びつくだろう？もうちょい深堀りが必要。

biphasic growth modelの元になるvon bertalanffyの成長式は、同化作用（anabolic)過程:エネルギーの獲得（$Aw^n$) と、異化作用（catabolic)過程：エネルギーの損失（$kw$)の過程から構成され、呼吸はkwに関係すると考えた。彼の成長と代謝に関する解釈は、単純すぎる。損失はエネルギーの獲得過程でも生じるし、再生産による損失は考えていない。

エネルギー代謝を絵に書くと図3.7 数式に書くと以下の式になる。

$$
C(w)=M_{assim}(w) + M_{std}(w) +M_{act}(w) + R_{egg}(w)/\varepsilon_{egg}+g(w)
$$

$C(w)$ :consumption, $M_{assim}(w)$:  assimilation

$M_{std}(w)$: standard metabolism, $M_{act}(w)$ :activity

$R_{egg}(w)/\varepsilon_{egg}$:reproduction

$g(w)$:growth

すべての項は湿重量の関数であり、湿重量はエネルギーに換算できる（１gで5.5KJ）ので、上の式はenergy budgetを表現しているといえる。これらを2章でえたパラメータに置き換えていく。


図3.7


# Consumption and Assimilation
2章において、消費率は$C(w) = f_0hw^n$ (2.18式)と記述した。ここで摂餌レベル$f_0$ は最大消費レベル$hw^n$の一部としての消費である。消費がすべて同化されるわけではなく、エネルギーに使用されずに排出される損失（ egestion:消化器系による排泄+ excreation:血液系による排泄）、消化吸収に関係する代謝（$M_{assim}$による損失がある。これらは摂餌量に比例する。Kitchell  el al(1977)は消化行動で15％、egestionで15％、excreationで10％のロスがあると見積もった。この部分を最大消費量に対する損失を表現する係数$\varepsilon_a$として、2章の2.18式にかけると、同化量は以下のように書ける。
$$
C_{assim}(w) = \varepsilon_af_0hw^n＝C(w)-M_{assim}
$$

# Standard Metabolism and Activity

standatd metabolism は、生命を維持するために必要な基本的な代謝量であり、

$$M_{std} = k_sw^n$$と書ける。

一方、activity metabolismは見積もりが難しい。ここはシンプルに、$M_{std}$に比例するとし、その比率は$k_s$に含まれると考える。standard and activity metabolismは、最大消費率$hw^n$に比例すると考えることができ、

$k_s = f_c\varepsilon_ah$ とする。$f_c$は限界摂餌レベルである。生命の維持と摂餌のための代謝はしたがって、ksを限界摂餌レベルの$\varepsilon_ah$　倍として以下のように書くことができる。
$$
M_{std}(w) + M_{act} = f_c\varepsilon_ahw^n
$$

Hartvig et al(2011)により、$f_c $ はおよそ0.2とする。



さて3.26 式を書き換えて成長を表すようにまとめると、
$$
g(w) = \varepsilon_af_0hw^n -f_c\varepsilon_ahw^n-\psi(w/w_m)kw
$$

$$
g(w) = \varepsilon_ah(f_0-f_c)w^n-\psi(w/w_m)kw
$$

$$
A=\varepsilon_ah(f_0-f_c)
$$

となる。$\varepsilon_a, f_0, fc, h$　の定数は、種によって大きく違わない(life history invariantsである）ことが期待される。なので成長係数Aは一定と扱うことができる（じつは$f_0$は4章のモデルにより一定とは言えないことがわかってるんだけど）。 



# 3.4 Master traitは他にない?

- $W_\infty$をMaster traitとする利点
     - 使いやすく推定が楽。
     - data-limitedな資源でも推定可能
  - 直感的（intuitive)にわかりやすい

- $W_{\infty}$　と$A$  からの他のパラメータを決められる？

  - 理論的には正しいが、データからは明確に示せていない

  例えば$W_\infty$ と$W_m$ (成熟サイズ) の比（$\eta_m$)は種によってかなり異なる→invariantsといえる？



# 検討

- "Invariant”とは”種によらず一定"ということではない
  - 他の形質（成長速度、水温などの環境、系統発生学的な位置関係）と”co-vary”ではない
  - invariantとされる形質の魚種による変動はランダムで、予測不能である

- データに限界がある

  - パラメータのいくつかは直接推定されていない
  - たとえばAはvBモデルで得られたKと$L_{\infty}$から推定ー考慮していないバイアスが含まれるだろうし、systematicなバイアスもあるだろう。
  - 既往のvBモデルは1個体の成長ではなく平均である。
  - 再生産投資などは推定自体が難しい

- 変動を説明する形質をすべて考慮できていない

  - 候補の形質はslow-fast life history continuum と防御にかかるコスト
  - 考慮すべき形質が増えるとモデルは複雑になる→意味のある改善がみとめられない限り、考慮すべき形質は少ないほうが良い

- 最小モデルのMaster traitとして極限サイズを用いることとする。

  

# 3.5 Summary

- この章で構築したモデルは、成長と再生産（繁殖）が極限サイズが異なる魚種間でどのように変化するかを示す：極限サイズが大きい魚種は、サイズあたりの繁殖投資が少ない。
- 成長に関するその他のみかたも、パラメータのセットをつかって説明できる。これらパラメータは種の間でかならずしもinvariantではないが、極限サイズとの関係においてsystematicな変動はない。このため極限サイズは<span style="color:dark red;"> Master trait</span>となりうるのだ。

para2

- vBのモデルとは一致しない：Juvenile stageでの予測値が小さくなる。
- 吸収と基礎代謝による損失においてn=3/4を用いたことに由来する。
- 3/4より大きい可能性があり、改善が必要かもしれない

para3 

activityなどによる損失のスケールに3/4以上を用いない重要な理由は、損失のスケールをエネルギー獲得のためのスケールより大きくすると、すべての魚の$W_\infty$を制限することになるためである。この制限は図3.1bに示されている。$W_\infty$ が大きいということは、損失にかかる係数は小さいということを意味する。

もしすべての魚種の$W_\infty$が1トンならば、3.17式から、係数ｋは$A(1 ton)^{0.25}\approx 0.17yr^{-1}$ より大きくはならない。これが10kgなら0.54，10gなら3.0であり、小型の魚種にとっては取るに足らない数字になる。あるいは、この損失項（Massim+Mstd+Mact)の係数が定数でなく、サイズによって変化すると考えたらどうだろう？しかし基礎代謝や活動のための代謝が大きい魚ほど小さくなるだろうか？むしろ代謝率は他の形質に関係すると見たほうが良い。もし代謝がサイズに依存するということが言えるようになったら、極限体長への依存性を維持することは問題にならなくなる。その場合はもっと高い精度と複雑なモデルが必要になる、ursin(1967)のような。

- 本章のモデルは完璧ではないー筋の通った一般性のある理論を構築するために精度を犠牲
- シンプルなモデル構築し、魚種による変動をMaster traitである$W_\infty$で示すという目的を果たすものである。



```{r testcalc, include = FALSE}
A = 5.35
Winf = 10^6
W10=10
Wth =10000
n = 0.9

A*Winf^(n-1)
A*Wth^(n-1)
A*W10^(n-1)

```
